(()=>{"use strict";var e=[,e=>{e.exports=require("@nestjs/core")},function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.AppModule=void 0;const o=i(3),s=i(4),n=i(1),a=i(101),c=i(10),d=i(63),p=i(102),u=i(106),l=i(70),f=i(72),v=i(107),_=i(84),h=i(110),y=i(98),m=i(113),S=i(116),j=i(122),g=i(127);let b=class{};t.AppModule=b,t.AppModule=b=r([(0,o.Module)({imports:[c.ConfigModule.forRoot({isGlobal:!0}),s.UserModule,l.TeamModule,f.ProjectModule,d.AuthModule,p.DocsModule,u.PluginModule,v.OpenApiModule,_.NotificationModule,h.InvitesModule,y.ApisModule,m.ModelsModule,S.TestingModule,j.FilesModule,g.HelpModule],controllers:[],providers:[{provide:n.APP_GUARD,useClass:a.JwtAuthGuard}]})],b)},e=>{e.exports=require("@nestjs/common")},function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.UserModule=void 0;const o=i(3),s=i(5),n=i(6),a=i(61),c=i(62),d=i(63),p=i(70),u=i(72);let l=class{};t.UserModule=l,t.UserModule=l=r([(0,o.Module)({imports:[a.PrismaModule,c.SmsModule,d.AuthModule,(0,o.forwardRef)((()=>p.TeamModule)),(0,o.forwardRef)((()=>u.ProjectModule))],controllers:[s.UserController],providers:[n.UserService],exports:[n.UserService]})],l)},function(e,t,i){var r,o,s,n=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.UserController=void 0;const d=i(3),p=i(6),u=i(56),l=i(16),f=i(59),v=i(60),_=i(19);let h=class{constructor(e,t){this.userService=e,this.toolsService=t}register(e,t){const i={...e,ip:this.toolsService.getReqIP(t)};return(0,u.Send)(this.userService.createUser(i))}checkUserName(e){return(0,u.Send)(this.userService.checkUserName(e))}getUserProfile(e){return(0,u.Send)(this.userService.getUserProfile(e.user.sub))}getTeamList(e){return(0,u.Send)(this.userService.getTeamListByUserId(e.user.sub))}getProjectList(e){return(0,u.Send)(this.userService.getProjectListByUserId(e.user.sub))}updateTeam(e,t){const i={...t,uid:e.user.sub};return(0,u.Send)(this.userService.updateUserInfo(i))}bindPhone(e,t){const i={...t,uid:e.user.sub};return(0,u.Send)(this.userService.bindPhone(i))}bindEmail(e,t){const i={...t,uid:e.user.sub};return(0,u.Send)(this.userService.bindEmail(i))}unbindEmail(e){const t=e.user.sub;return(0,u.Send)(this.userService.unBindEmail(t))}setPassword(e,t){const i={...t,uid:e.user.sub};return(0,u.Send)(this.userService.setPassword(i))}deleteAccount(e){const t=e.user.sub;return(0,u.Send)(this.userService.deleteAccount(t))}bindThirdPartyAccount(){return"绑定第三方账户"}sendSmsCode(e){const t=e?.phone,i=e?.type,r=new l.default({length:6,dictionary:"number"}).rnd();return(0,u.Send)(this.userService.sendPhoneVerifyCode({phone:t,code:r,type:[1,2,3,4,5].includes(i)?i:2}))}sendEmailCode(e){const t=e?.email,i=new l.default({length:6,dictionary:"number"}).rnd();return(0,u.Send)(this.userService.sendEmailVerifyCode({email:t,code:i}))}};t.UserController=h,n([(0,f.Public)(),(0,d.Post)("/register"),c(0,(0,d.Body)()),c(1,(0,d.Request)()),a("design:type",Function),a("design:paramtypes",["function"==typeof(s=void 0!==v.CREATE_USER&&v.CREATE_USER)?s:Object,Object]),a("design:returntype",void 0)],h.prototype,"register",null),n([(0,d.Get)("check-user-name"),c(0,(0,d.Query)()),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",void 0)],h.prototype,"checkUserName",null),n([(0,d.Get)("/my-profile"),c(0,(0,d.Req)()),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",void 0)],h.prototype,"getUserProfile",null),n([(0,d.Get)("/my-teams"),c(0,(0,d.Req)()),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",void 0)],h.prototype,"getTeamList",null),n([(0,d.Get)("/my-projects"),c(0,(0,d.Req)()),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",void 0)],h.prototype,"getProjectList",null),n([(0,d.Patch)("/my-profile"),c(0,(0,d.Req)()),c(1,(0,d.Body)()),a("design:type",Function),a("design:paramtypes",[Object,Object]),a("design:returntype",void 0)],h.prototype,"updateTeam",null),n([(0,d.Post)("/bind-phone"),c(0,(0,d.Req)()),c(1,(0,d.Body)()),a("design:type",Function),a("design:paramtypes",[Object,Object]),a("design:returntype",void 0)],h.prototype,"bindPhone",null),n([(0,d.Post)("/bind-email"),c(0,(0,d.Req)()),c(1,(0,d.Body)()),a("design:type",Function),a("design:paramtypes",[Object,Object]),a("design:returntype",void 0)],h.prototype,"bindEmail",null),n([(0,d.Post)("/unbind-email"),c(0,(0,d.Req)()),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",void 0)],h.prototype,"unbindEmail",null),n([(0,d.Post)("/set-password"),c(0,(0,d.Req)()),c(1,(0,d.Body)()),a("design:type",Function),a("design:paramtypes",[Object,Object]),a("design:returntype",void 0)],h.prototype,"setPassword",null),n([(0,d.Delete)("/delete-account"),c(0,(0,d.Req)()),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",void 0)],h.prototype,"deleteAccount",null),n([(0,d.Post)("/bind-third-party-account"),a("design:type",Function),a("design:paramtypes",[]),a("design:returntype",void 0)],h.prototype,"bindThirdPartyAccount",null),n([(0,f.Public)(),(0,d.Post)("/send-sms-code"),c(0,(0,d.Body)()),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",void 0)],h.prototype,"sendSmsCode",null),n([(0,f.Public)(),(0,d.Post)("/send-email-code"),c(0,(0,d.Body)()),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",void 0)],h.prototype,"sendEmailCode",null),t.UserController=h=n([(0,d.Controller)({version:"1.0",path:"users"}),a("design:paramtypes",["function"==typeof(r=void 0!==p.UserService&&p.UserService)?r:Object,"function"==typeof(o=void 0!==_.ToolsService&&_.ToolsService)?o:Object])],h)},function(e,t,i){var r,o,s,n,a,c,d,p=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.UserService=void 0;const f=i(3),v=i(7),_=i(8),h=i(9),y=i(14),m=i(15),S=i(16),j=i(17),g=i(19),b=i(27),w=i(25),O=i(29),P=i(54),R=i(55);let E=class{constructor(e,t,i,r,o,s,n){this.prismaService=e,this.smsService=t,this.redisService=i,this.toolsService=r,this.authService=o,this.teamService=s,this.projectService=n}findByEmail(e){return this.prismaService.users.findFirstOrThrow({where:{email:e}})}findByPhone(e){return this.prismaService.users.findFirstOrThrow({where:{phone:e}})}async getUserProfile(e){const t=await this.prismaService.users.findUniqueOrThrow({select:{uid:!0,avatar:!0,nick_name:!0,contact_number:!0,phone:!0,email:!0,location:!0,profession:!0,create_time:!0,last_login_time:!0,last_activity_time:!0,pwd_hash:!0,default_team_id:!0,default_project_id:!0,description:!0},where:{uid:e}}),i=(0,v.isEmpty)(t?.pwd_hash)?-1:1;return{...(0,v.omit)(t,["pwd_hash"]),hasPassword:i}}async getUserProjectRole(e){const t=await this.prismaService.userProjects.findFirst({select:{role:!0},where:{uid:e.user_id,project_id:e.project_id}});return(0,v.isNumber)(t?.role)?t?.role:0}async getTeamRoleByProjectId(e){const t=await this.prismaService.projects.findUnique({select:{team_id:!0},where:{project_id:e.project_id}});if(!t)throw new f.HttpException("项目不存在",f.HttpStatus.OK);const i=await this.prismaService.userTeams.findUnique({select:{role:!0},where:{team_id_uid:{team_id:t.team_id,uid:e.user_id}}});return(0,v.isNumber)(i?.role)?i?.role:0}async getUserTeamRole(e){if(!await this.prismaService.teams.findUnique({where:{team_id:e.team_id}}))throw new f.HttpException("团队不存在",f.HttpStatus.OK);const t=await this.prismaService.userTeams.findUnique({select:{role:!0},where:{team_id_uid:{team_id:e.team_id,uid:e.user_id}}});return(0,v.isNumber)(t?.role)?t?.role:0}async sendPhoneVerifyCode(e){const{phone:t,code:i,type:r}=e;if(!(0,R.isPhoneNumber)(t,"CN"))throw new f.HttpException("请输入有效手机号",f.HttpStatus.OK);return await this.redisService.set(t,i,300),await this.smsService.sendPhoneVerifyCode(t,i,r),"ok"}async sendEmailVerifyCode(e){const{email:t,code:i}=e;if(!(0,R.isEmail)(t))throw new f.HttpException("请输入有效电子邮件",f.HttpStatus.OK);return await this.redisService.set(t,i,300),await this.smsService.sendEmailVerifyCode(t,i),"ok"}async checkUserName(e){const t=await this.prismaService.users.findFirst({where:e});return(0,v.isPlainObject)(t)?1:-1}async createEmailUser(e){if(1===await this.checkUserName((0,v.pick)(e,["email"])))throw new f.HttpException("当前邮箱已注册",f.HttpStatus.OK);const t=await this.redisService.get(e.email);if(console.log(t),(0,v.isNull)(t)||`${t}`!==e.verify_code)throw await this.redisService.del(e.email),new f.HttpException("邮箱验证码错误",f.HttpStatus.OK);return await this.prismaService.users.create({data:{uid:e.uid,avatar:e.avatar,nick_name:e.nick_name,create_time:(0,w.default)().format(),err_login_count:0,email:e.email,pwd_salt:e.pwd_salt,pwd_hash:e.pwd_hash,create_ip:e.ip}})}async createPhoneUser(e){if(1===await this.checkUserName((0,v.pick)(e,["phone"])))throw new f.HttpException("当前手机号已注册",f.HttpStatus.OK);const t=await this.redisService.get(e.phone);if((0,v.isNull)(t)||`${t}`!==e.verify_code)throw await this.redisService.del(e.phone),new f.HttpException("手机验证码错误",f.HttpStatus.OK);return await this.prismaService.users.create({data:{uid:e.uid,avatar:e.avatar,nick_name:e.nick_name,create_time:(0,w.default)().format(),err_login_count:0,phone:e.phone,pwd_salt:e.pwd_salt,pwd_hash:e.pwd_hash,create_ip:e.ip}})}getRandomAvatar(){const e=m.DEFAULT_AVATOARS.length-1,t=Math.floor(Math.random()*(e+1))+0;return m.DEFAULT_AVATOARS[t]}async createUser(e){if("email"===e.type&&!(0,R.isEmail)(e.email))throw new f.HttpException("邮箱格式不符合规范",f.HttpStatus.OK);if("phone"===e.type&&!(0,R.isPhoneNumber)(e.phone,"CN"))throw new f.HttpException("手机号码不符合规范",f.HttpStatus.OK);if(!(0,R.isStrongPassword)(e?.password,m.STRONG_PWD_OPTIONS))throw new f.HttpException("密码强度不符合规范",f.HttpStatus.OK);if(e.password!==e.password_confirm)throw new f.HttpException("两次密码输入不一致",f.HttpStatus.OK);const t=this.getRandomAvatar(),i=(0,y.v4)(),r=new S.default({length:10}).rnd(),o=this.toolsService.makePassword(e.password,r),s={...e,avatar:t,uid:i,pwd_salt:r,pwd_hash:o};"email"===e.type&&await this.createEmailUser(s),"phone"===e.type&&await this.createPhoneUser(s);const n=await this.teamService.createTeam({user_id:i,team_id:(0,y.v4)(),team_name:e.nick_name+"的团队",description:null}),a=await this.projectService.createProject({user_id:i,team_id:n.team_id,description:"",project_id:(0,y.v4)(),name:"示例项目",create_example_datas:1,type:"http",logo:this.getRandomAvatar(),create_time:(0,w.default)().format()});return await this.prismaService.users.update({where:{uid:i},data:{default_team_id:n.team_id,default_project_id:a.project_id}}),!0}async getTeamListByUserId(e){return await this.teamService.getTeamListByUserId(e)}async getProjectListByUserId(e){const t=await this.prismaService.userProjects.findMany({select:{project_id:!0,role:!0,project:{select:{name:!0,logo:!0,description:!0,team_id:!0,create_time:!0,creater_id:!0}}},where:{uid:e,role:{in:[1,2,4,6]}},orderBy:{project:{db_id:"asc"}}});return(0,v.isArray)(t)?t.map((t=>({...t.project,project_id:t.project_id,role:t.role,user_id:e,create_time:t.project.create_time,owner:t.project.creater_id===e?1:-1}))):[]}async updateUserInfo(e){const t=(0,v.pick)(e,["avatar","nick_name","contact_number","location","profession","description"]);return await this.prismaService.users.update({where:{uid:e.uid},select:{uid:!0,nick_name:!0,avatar:!0,contact_number:!0,location:!0,profession:!0,description:!0},data:t})}async bindPhone(e){const t=await this.redisService.get(e.phone);if((0,v.isNull)(t)||`${t}`!==e.verify_code)throw await this.redisService.del(e.phone),new f.HttpException("手机验证码错误",f.HttpStatus.OK);const i=await this.prismaService.users.findFirst({select:{uid:!0},where:{phone:e.phone}});if((0,v.isObject)(i)&&i.uid!==e.uid)throw new f.HttpException("该手机号已被其他账户绑定",f.HttpStatus.OK);return await this.prismaService.users.update({data:{phone:e.phone},where:{uid:e.uid}}),!0}async bindEmail(e){const t=await this.redisService.get(e.email);if((0,v.isNull)(t)||`${t}`!==e.verify_code)throw await this.redisService.del(e.email),new f.HttpException("邮箱验证码错误",f.HttpStatus.OK);const i=await this.prismaService.users.findFirst({select:{uid:!0},where:{email:e.email}});if((0,v.isObject)(i)&&i.uid!==e.uid)throw new f.HttpException("该邮箱已被其他账户绑定",f.HttpStatus.OK);return await this.prismaService.users.update({data:{email:e.email},where:{uid:e.uid}}),!0}async unBindEmail(e){const t=await this.prismaService.users.findUnique({where:{uid:e}});if((0,v.isEmpty)(t?.phone))throw new f.HttpException("手机号或邮箱必须保留一个方可登录",f.HttpStatus.OK);return await this.prismaService.users.update({data:{email:null},where:{uid:e}}),!0}async getUserInfo(e){const t=await this.prismaService.users.findUnique({where:{uid:e}});if(!t)throw new f.HttpException("用户不存在",f.HttpStatus.BAD_REQUEST);return t}async setPassword(e){const t=await this.getUserInfo(e.uid),i=this.toolsService.makePassword(e.password_old,t.pwd_salt);if(!(0,v.isEmpty)(t.pwd_hash)&&t.pwd_hash!==i)throw new f.HttpException("旧密码输入错误",f.HttpStatus.OK);return this.reSetPassword(e)}async reSetPassword(e){const t=await this.getUserInfo(e.uid);if(!(0,R.isStrongPassword)(e?.password,m.STRONG_PWD_OPTIONS))throw new f.HttpException("密码强度不符合规范",f.HttpStatus.OK);if(e.password!=e.password_confirm)throw new f.HttpException("两次密码输入不一致",f.HttpStatus.OK);const i=this.toolsService.makePassword(e.password,t.pwd_salt);await this.prismaService.users.update({data:{pwd_hash:i},where:{uid:e.uid}});const r=this.authService.getTokens(e.uid);return await this.authService.updateRefreshToken(e.uid,r.refreshToken),!0}async deleteAccount(e){const t=await this.prismaService.teams.findMany({select:{team_id:!0,name:!0},where:{owner_id:e}});await this.prismaService.userProjects.deleteMany({where:{uid:e}}),await this.prismaService.userTeams.deleteMany({where:{uid:e}});for(const i of t)try{await this.teamService.disbandTeam({user_id:e,team_id:i.team_id,team_name:i.name})}catch(e){}return await this.prismaService.users.delete({where:{uid:e}}),!0}};t.UserService=E,t.UserService=E=p([(0,f.Injectable)(),l(5,(0,f.Inject)((0,f.forwardRef)((()=>P.TeamService)))),l(6,(0,f.Inject)((0,f.forwardRef)((()=>O.ProjectService)))),u("design:paramtypes",["function"==typeof(r=void 0!==j.PrismaService&&j.PrismaService)?r:Object,"function"==typeof(o=void 0!==_.SmsService&&_.SmsService)?o:Object,"function"==typeof(s=void 0!==h.RedisService&&h.RedisService)?s:Object,"function"==typeof(n=void 0!==g.ToolsService&&g.ToolsService)?n:Object,"function"==typeof(a=void 0!==b.AuthService&&b.AuthService)?a:Object,"function"==typeof(c=void 0!==P.TeamService&&P.TeamService)?c:Object,"function"==typeof(d=void 0!==O.ProjectService&&O.ProjectService)?d:Object])],E)},e=>{e.exports=require("lodash")},function(e,t,i){var r,o,s=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.SmsService=void 0;const a=i(3),c=i(9),d=i(12),p=i(13),u=i(10);let l=class{constructor(e,t){this.configService=e,this.redisService=t}delay(e){return new Promise((t=>{setTimeout(t,e)}))}async sendPhoneVerifyCode(e,t,i){const r=`VerifyCode${e}`;if(await this.redisService.get(r))throw new a.HttpException("1分钟内不能重复发送",a.HttpStatus.OK);return await this.redisService.set(r,!0,60),await this.sendSmsMessage({phone:e,code:t,type:i}),!0}async sendEmailVerifyCode(e,t){const i=`VerifyCode${e}`;if(await this.redisService.get(i))throw new a.HttpException("1分钟内不能重复发送",a.HttpStatus.OK);await this.redisService.set(i,!0,60);const r=d.SMS_EMAIL_CONTENT.replace("{code}",t);return await this.sendEmailMessage(e,"【Hapydev】 邮箱验证码",r),!0}async sendEmailMessage(e,t,i){const r=this.configService.get("EMAIL_SERVICE_API"),o=await p.default.post(r,{email:e,title:t,content:i});return o?.data}async sendSmsMessage(e){const t=this.configService.get("SMS_SERVICE_API"),i=await p.default.post(t,e);return i?.data}};t.SmsService=l,t.SmsService=l=s([(0,a.Injectable)(),n("design:paramtypes",["function"==typeof(r=void 0!==u.ConfigService&&u.ConfigService)?r:Object,"function"==typeof(o=void 0!==c.RedisService&&c.RedisService)?o:Object])],l)},function(e,t,i){var r,o=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.RedisService=void 0;const n=i(3),a=i(10),c=i(11),d=i(7);let p=class{constructor(e){this.configService=e,this.redisClient=new c.default(e.get("REDIS_URL"))}onModuleInit(){this.redisClient||this.getClient()}getClient(){}async set(e,t,i){return t=(0,d.isObject)(t)?JSON.stringify(t):t,i?await this.redisClient.set(e,t,"EX",i):await this.redisClient.set(e,t)}async incr(e){return await this.redisClient.incr(e)}async get(e){try{const t=await this.redisClient.get(e);return t?JSON.parse(t):null}catch(t){return await this.redisClient.get(e)}}async del(e){return await this.redisClient.del(e)}async hset(e,t){return await this.redisClient.hset(e,t)}async hget(e,t){return await this.redisClient.hget(e,t)}async hgetall(e){return await this.redisClient.hgetall(e)}async flushall(){return await this.redisClient.flushall()}};t.RedisService=p,t.RedisService=p=o([(0,n.Injectable)(),s("design:paramtypes",["function"==typeof(r=void 0!==a.ConfigService&&a.ConfigService)?r:Object])],p)},e=>{e.exports=require("@nestjs/config")},e=>{e.exports=require("ioredis")},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SMS_EMAIL_CONTENT=void 0,t.SMS_EMAIL_CONTENT='<table bgcolor=#fff border=0 cellpadding=0 cellspacing=0 style="text-align:center;width:520px;margin:16px auto;padding:24px 24px 40px;border-radius:0 0 8px 8px;box-shadow:#c1c1c1 0 0 1px"><tr><td><div style="margin:0 auto;padding:50px 0;font-size:32px;font-weight:600;letter-spacing:0;border-bottom:4px solid #2aacff">Hapydev 账号邮箱验证码</div><tr><td><div style="max-width:400px;text-align:center;margin:0 auto;word-break:break-all;padding-top:20px;font-size:14px;line-height:1.4;left:0;font-weight:400"><p>你正在进行邮箱验证操作，验证码为:<p style=font-size:24px>{code}<p>此验证码 15 分钟内有效<p>如非本人操作 请勿理会</div><tr><td style="font-size:13px;line-height:1.6;color:#5c5c5c;padding:25px 0"><div style=color:rgba(24,24,25,.42);font-size:14px;line-height:20px;margin-top:32px><a href=https://www.hapydev.com rel=noopener style=color:#2aacff;text-decoration:none target=_blank>Hapydev</a> - 更懂中国程序员的研发效率工具</div></table>'},e=>{e.exports=require("axios")},e=>{e.exports=require("uuid")},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.STRONG_PWD_OPTIONS=t.DEFAULT_AVATOARS=void 0,t.DEFAULT_AVATOARS=["bear.png","bee.png","chicken.png","cow.png","elephant.png","fish.png","giraffe.png","gorilla.png","jaguar.png","labrador-retriever.png","lion.png","meerkat.png","owl.png","panda-bear.png","panda.png","pig.png","plane.png","puffer-fish.png","rabbit.png","scholarship.png","seagull.png","sheep.png","ship.png","snake.png","tiger.png","turtle.png","wolf.png","zebra.png"],t.STRONG_PWD_OPTIONS={minLength:8,minLowercase:1,minUppercase:1,minNumbers:1,minSymbols:0}},e=>{e.exports=require("short-unique-id")},function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.PrismaService=void 0;const o=i(3),s=i(18);let n=class extends s.PrismaClient{async onModuleInit(){await this.$connect()}};t.PrismaService=n,t.PrismaService=n=r([(0,o.Injectable)()],n)},e=>{e.exports=require("@prisma/client")},function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ToolsService=void 0;const s=i(3),n=i(14),a=i(20),c=i(23),d=i(24),p=i(25);let u=class{constructor(){this.getUniqueID=()=>`${this.snowflake.getUniqueID()}`,this.snowflake=new d.Snowflake({instance_id:1,custom_epoch:1e3*(0,p.default)("2020-1-1").unix()})}get uuidToken(){return(0,n.v4)().replace(/-/g,"")}get getRandomSalt(){return(0,a.randomString)((0,a.getRandomNum)(10,20))}getReqIP(e){const t=(e.headers["x-forwarded-for"]||e.socket.remoteAddress)?.replace("::ffff:","")??"";return t.split(",").length?t.split(",").shift():t}makePassword(e,t){return(0,a.strToMd5)(`${e}_${t}`)}getAccessTokenKey(e){return`${c.ACCESS_TOKEN_PREFIX}_${e}`}getRefreshTokenKey(e){return`${c.REFRESH_TOKEN_PREFIX}_${e}`}};t.ToolsService=u,t.ToolsService=u=r([(0,s.Injectable)(),o("design:paramtypes",[])],u)},(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.strToMd5=t.randomString=t.getRandomNum=void 0;const r=i(21),o=i(22);t.getRandomNum=(e,t)=>Math.floor(e+Math.random()*(t-e));t.randomString=e=>o(e).toString("hex").slice(0,e);t.strToMd5=e=>r.MD5(e).toString()},e=>{e.exports=require("crypto-js")},e=>{e.exports=require("randombytes")},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.REFRESH_TOKEN_PREFIX=t.ACCESS_TOKEN_PREFIX=t.ADMIN_PREFIX=void 0,t.ADMIN_PREFIX="admin",t.ACCESS_TOKEN_PREFIX="ACCESS_TOKEN_PREFIX",t.REFRESH_TOKEN_PREFIX="REFRESH_TOKEN_PREFIX"},e=>{e.exports=require("nodejs-snowflake")},(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=i(26);t.default=r},e=>{e.exports=require("dayjs")},function(e,t,i){var r,o,s,n,a,c=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.AuthService=void 0;const p=i(3),u=i(10),l=i(28),f=i(19),v=i(7),_=i(9),h=i(17),y=i(25);let m=class{constructor(e,t,i,r,o){this.prismaService=e,this.jwtService=t,this.configService=i,this.toolsService=r,this.redisService=o}findByEmail(e){return this.prismaService.users.findFirstOrThrow({where:{email:e}})}findByPhone(e){return this.prismaService.users.findFirstOrThrow({where:{phone:e}})}getOpenApiToken(e,t){return this.jwtService.sign({sub:e},{secret:this.configService.get("JWT_ACCESS_SECRET"),expiresIn:`${t.value}${t.unit}`})}getTokens(e){return{accessToken:this.jwtService.sign({sub:e},{secret:this.configService.get("JWT_ACCESS_SECRET"),expiresIn:this.configService.get("JWT_ACCESS_EXPIRES")}),refreshToken:this.jwtService.sign({sub:e},{secret:this.configService.get("JWT_REFRESH_SECRET"),expiresIn:this.configService.get("JWT_REFRESH_EXPIRES")})}}async signIn(e){let t=null;if("email"===e?.login_type&&(t=await this.findByEmail(e?.email)),"phone"===e?.login_type&&(t=await this.findByPhone(e.phone)),!t)throw new p.HttpException("User does not exist",p.HttpStatus.OK);const i=this.toolsService.makePassword(e.password,t.pwd_salt);if(!(0,v.isEqual)(i,t.pwd_hash))throw new p.HttpException("Incorrect username or password",p.HttpStatus.OK);await this.prismaService.users.update({where:{uid:t.uid},data:{last_login_time:(0,y.default)().format(),last_ip:e?.ip}});const r=this.getTokens(t.uid);return await this.updateRefreshToken(t.uid,r.refreshToken),{uid:t.uid,...r}}async logout(e){const t=this.toolsService.getRefreshTokenKey(e);return this.redisService.del(t)}async updateRefreshToken(e,t){const i=this.toolsService.getRefreshTokenKey(e);await this.redisService.set(i,t,2592e3)}async refreshTokens(e){if((0,v.isEmpty)(e))throw new p.HttpException("Invalid argument",p.HttpStatus.OK);const t=this.jwtService.decode(e);if(this.jwtService.verify(e,{secret:this.configService.get("JWT_REFRESH_SECRET")}),!t?.sub)throw new p.HttpException("Is invalid token , please log in again",p.HttpStatus.OK);const i=this.toolsService.getRefreshTokenKey(t?.sub),r=await this.redisService.get(i);if(!r||r!==e)throw new p.HttpException("You are not logged in yet, please log in first",p.HttpStatus.OK);return{accessToken:(await this.getTokens(t.sub)).accessToken}}};t.AuthService=m,t.AuthService=m=c([(0,p.Injectable)(),d("design:paramtypes",["function"==typeof(r=void 0!==h.PrismaService&&h.PrismaService)?r:Object,"function"==typeof(o=void 0!==l.JwtService&&l.JwtService)?o:Object,"function"==typeof(s=void 0!==u.ConfigService&&u.ConfigService)?s:Object,"function"==typeof(n=void 0!==f.ToolsService&&f.ToolsService)?n:Object,"function"==typeof(a=void 0!==_.RedisService&&_.RedisService)?a:Object])],m)},e=>{e.exports=require("@nestjs/jwt")},function(e,t,i){var r,o,s,n,a,c,d,p,u,l,f=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},v=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},_=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ProjectService=void 0;const h=i(3),y=i(17),m=i(7),S=i(6),j=i(14),g=i(30),b=i(32),w=i(34),O=i(36),P=i(38),R=i(25),E=i(40),M=i(19),x=i(41),H=i(49);let T=class{constructor(e,t,i,r,o,s,n,a,c,d){this.prismaService=e,this.toolsService=t,this.userService=i,this.apisConfigService=r,this.docService=o,this.envsService=s,this.mocksService=n,this.serversService=a,this.notificationService=c,this.apisService=d}async getProjectsByTeamId(e){return await this.prismaService.projects.findMany({select:{project_id:!0,name:!0,description:!0,logo:!0,create_time:!0},where:{team_id:e}})}async getProjectsByUserIdAndTeamId(e){const{team_id:t,user_id:i}=e;if((0,m.isEmpty)(t)||(0,m.isEmpty)(i))throw new h.HttpException("请求参数无效",h.HttpStatus.BAD_REQUEST);const r=await this.prismaService.userProjects.findMany({include:{project:!0},where:{uid:i,project:{team_id:t}}});if(!(0,m.isArray)(r))return[];return r.map((e=>({...(0,m.pick)(e.project,["team_id","project_id","name","logo"]),role:e.role})))}async forceDeleteProject(e){await this.prismaService.projectMockConfigs.deleteMany({where:{project_id:e}}),await this.prismaService.projectApisConfigs.deleteMany({where:{project_id:e}}),await this.prismaService.projectWebhooks.deleteMany({where:{project_id:e}}),await this.prismaService.projectCommonScripts.deleteMany({where:{project_id:e}}),await this.prismaService.projectParams.deleteMany({where:{project_id:e}}),await this.prismaService.projectServers.deleteMany({where:{project_id:e}}),await this.prismaService.projectEnviroments.deleteMany({where:{project_id:e}}),await this.prismaService.userProjects.deleteMany({where:{project_id:e}}),await this.prismaService.document.deleteMany({where:{project_id:e}})}async addUserToProject(e){return await this.prismaService.userProjects.create({data:{...e,join_time:(0,R.default)().format()}})}async createSampleApis(e,t){const i=[],r=(t,o)=>{(0,m.isArray)(t)&&t?.forEach(((t,s)=>{const n=(0,j.v4)();i.push({...t.data,id:n,sort:s+1,parent_id:o,project_id:e}),(0,m.isArray)(t?.children)&&r(t?.children,n)}))};r(x.SAMPLE_APIS,"0"),await this.apisService.batchSaveApi({project_id:e,user_id:t,api_list:i})}async createProject(e){const t=e.project_id;await this.apisConfigService.initData(t),await this.docService.initData(t),await this.envsService.initData(t),await this.mocksService.initData(t),await this.serversService.initData(t);const i=(0,R.default)().format("YYYY-MM-DD"),r={db_id:this.toolsService.getUniqueID(),team_id:e.team_id,bucket_id:i,name:e.name,project_id:t,type:"http",create_time:(0,R.default)().format(),logo:e?.logo,description:e?.description,creater_id:e?.user_id},o=await this.prismaService.projects.create({data:r});return await this.addUserToProject({uid:e.user_id,project_id:t,role:6}),1===e.create_example_datas&&await this.createSampleApis(t,e.user_id),await this.notificationService.addNodify({uid:e.user_id,title:"项目消息",content:`项目 ${e.name} 创建成功`,type:2}),o}async deleteProject(e){const t=await this.userService.getTeamRoleByProjectId(e);if(![3,4].includes(t))throw new h.HttpException("权限不足",h.HttpStatus.OK);const i=await this.getProjectDetail(e);await this.prismaService.userProjects.deleteMany({where:{project_id:e.project_id}});const r=await this.prismaService.projects.delete({where:{project_id:e.project_id}});return await this.notificationService.addNodify({uid:e.user_id,title:"项目消息",content:`项目 ${i?.name} 已删除`,type:2}),r}async getProjectDetail(e){const t=await this.userService.getUserProjectRole(e);if(![4,6].includes(t))throw new h.HttpException("未授权",h.HttpStatus.OK);return await this.prismaService.projects.findUnique({where:{project_id:e.project_id}})}async updateProject(e){const t=await this.userService.getUserProjectRole(e);if(![2,6].includes(t))throw new h.HttpException("未授权",h.HttpStatus.OK);const i=(0,m.pick)(e,["name","description","logo"]);return await this.prismaService.projects.update({where:{project_id:e.project_id},data:i})}async moveProject(e){const t=await this.userService.getUserProjectRole(e);if(![2,6].includes(t))throw new h.HttpException("当前项目权限不足",h.HttpStatus.OK);const i=await this.userService.getUserTeamRole({user_id:e.user_id,team_id:e.new_team_id});if(![3,4].includes(i))throw new h.HttpException("目标团队权限不足",h.HttpStatus.OK);return await this.prismaService.projects.update({where:{project_id:e.project_id},data:{team_id:e.new_team_id,create_time:(0,R.default)().format()}})}async cloneProject(e){const t=await this.userService.getUserProjectRole(e);if(![4,6].includes(t))throw new h.HttpException("项目权限不足",h.HttpStatus.OK);const i=await this.userService.getTeamRoleByProjectId(e);if(![3,4].includes(i))throw new h.HttpException("团队权限不足",h.HttpStatus.OK)}async exitProject(e){const t=await this.userService.getUserProjectRole(e);if(![1,2,4,6].includes(t))throw new h.HttpException("项目权限不足",h.HttpStatus.OK);return await this.prismaService.userProjects.delete({where:{project_id_uid:{project_id:e.project_id,uid:e.user_id}}}),!0}async getProjectUserList(e){const t=await this.userService.getUserProjectRole(e);if(![4,6].includes(t))throw new h.HttpException("项目权限不足",h.HttpStatus.OK);const i=await this.prismaService.userProjects.findMany({select:{uid:!0},where:{project_id:e.project_id}});if(!(0,m.isArray)(i))return[];return await this.prismaService.users.findMany({select:{uid:!0,nick_name:!0,avatar:!0},where:{uid:{in:i.map((e=>e.uid))}}})}};t.ProjectService=T,t.ProjectService=T=f([(0,h.Injectable)(),_(2,(0,h.Inject)((0,h.forwardRef)((()=>S.UserService)))),_(9,(0,h.Inject)((0,h.forwardRef)((()=>H.ApisService)))),v("design:paramtypes",["function"==typeof(r=void 0!==y.PrismaService&&y.PrismaService)?r:Object,"function"==typeof(o=void 0!==M.ToolsService&&M.ToolsService)?o:Object,"function"==typeof(s=void 0!==S.UserService&&S.UserService)?s:Object,"function"==typeof(n=void 0!==g.ApisConfigService&&g.ApisConfigService)?n:Object,"function"==typeof(a=void 0!==b.DocsService&&b.DocsService)?a:Object,"function"==typeof(c=void 0!==w.EnvsService&&w.EnvsService)?c:Object,"function"==typeof(d=void 0!==O.MocksService&&O.MocksService)?d:Object,"function"==typeof(p=void 0!==P.ServersService&&P.ServersService)?p:Object,"function"==typeof(u=void 0!==E.NotificationService&&E.NotificationService)?u:Object,"function"==typeof(l=void 0!==H.ApisService&&H.ApisService)?l:Object])],T)},function(e,t,i){var r,o,s=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ApisConfigService=void 0;const c=i(3),d=i(17),p=i(31),u=i(7),l=i(6);let f=class{constructor(e,t){this.prismaService=e,this.userService=t}async getApiConfig(e){if((0,u.isEmpty)(e))throw new c.HttpException("请求参数无效",c.HttpStatus.BAD_REQUEST);return await this.prismaService.projectApisConfigs.findUnique({where:{project_id:e}})}async updateApisConfig(e){const t=e?.project_id,i=(0,u.pick)(e??{},["enabled_status"]);if((0,u.isEmpty)(t))throw new c.HttpException("请求参数无效",c.HttpStatus.BAD_REQUEST);if(6!==await this.userService.getUserProjectRole(e))throw new c.HttpException("未授权",c.HttpStatus.OK);return await this.prismaService.projectApisConfigs.update({where:{project_id:t},data:i})}async initData(e){const t={...p.INIT_CONFIG_DATA,project_id:e};await this.prismaService.projectApisConfigs.create({data:t})}};t.ApisConfigService=f,t.ApisConfigService=f=s([(0,c.Injectable)(),a(1,(0,c.Inject)((0,c.forwardRef)((()=>l.UserService)))),n("design:paramtypes",["function"==typeof(r=void 0!==d.PrismaService&&d.PrismaService)?r:Object,"function"==typeof(o=void 0!==l.UserService&&l.UserService)?o:Object])],f)},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.INIT_CONFIG_DATA=void 0;t.INIT_CONFIG_DATA={enabled_status:["developing","testing","released","deprecated","designing","pending","integrating","exception","tested","obsolete"].join(",")}},function(e,t,i){var r,o,s=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DocsService=void 0;const c=i(3),d=i(17),p=i(6),u=i(33);let l=class{constructor(e,t){this.prismaService=e,this.userService=t}async getDocumentConfig(e){const t=await this.userService.getUserProjectRole(e);if(![1,2,4,6].includes(t))throw new c.HttpException("未授权",c.HttpStatus.OK);return await this.prismaService.document.findUnique({where:{project_id:e.project_id}})}async updateState(e){if(6!==await this.userService.getUserProjectRole(e))throw new c.HttpException("未授权",c.HttpStatus.OK);return await this.prismaService.document.update({where:{project_id:e.project_id},data:{state:e.state}})}async updatePublishConfig(e){if(6!==await this.userService.getUserProjectRole(e))throw new c.HttpException("未授权",c.HttpStatus.OK);return await this.prismaService.document.update({where:{project_id:e.project_id},data:{publish_config:e.publish_config}})}async updateBaseConfig(e){if(6!==await this.userService.getUserProjectRole(e))throw new c.HttpException("未授权",c.HttpStatus.OK);return await this.prismaService.document.update({where:{project_id:e.project_id},data:{base_config:e.base_config}})}async initData(e){const t={...u.DEFAULT_DOCUMENT_DATA,project_id:e};await this.prismaService.document.create({data:t})}};t.DocsService=l,t.DocsService=l=s([(0,c.Injectable)(),a(1,(0,c.Inject)((0,c.forwardRef)((()=>p.UserService)))),n("design:paramtypes",["function"==typeof(r=void 0!==d.PrismaService&&d.PrismaService)?r:Object,"function"==typeof(o=void 0!==p.UserService&&p.UserService)?o:Object])],l)},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_DOCUMENT_DATA=void 0;t.DEFAULT_DOCUMENT_DATA={state:-1,publish_config:{secondary_domain:null,auth_type:1,env_ids:[],password:"",default_env_id:"default",enable_export:1,enable_clone:1},base_config:{title:null,description:"",top_notice:"",show_top_notice:-1,menu_show_type:1,primary_color:"#cccccc"}}},function(e,t,i){var r,o,s=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.EnvsService=void 0;const c=i(3),d=i(17),p=i(7),u=i(6),l=i(35);let f=class{constructor(e,t){this.prismaService=e,this.userService=t}async getEnviroments(e){const{project_id:t,user_id:i}=e,r=await this.prismaService.projectEnviroments.findMany({where:{OR:[{project_id:t,auth_type:2},{project_id:t,auth_type:1,creator_id:i}]},orderBy:{sort:"asc"}});return(0,p.isArray)(r)?r:[]}async createEnviroment(e){if(6!==await this.userService.getUserProjectRole(e))throw new c.HttpException("未授权",c.HttpStatus.OK);return await this.prismaService.projectEnviroments.upsert({where:{project_env_id:{project_id:e.project_id,env_id:e?.env_id}},update:{name:e?.name,auth_type:e?.auth_type,env_urls:e?.env_urls,icon:e?.icon,variables:e?.variables,sort:e?.sort},create:{project_id:e.project_id,env_id:e.env_id,name:e?.name,auth_type:e?.auth_type,env_urls:e?.env_urls,icon:e?.icon,variables:e?.variables,sort:e?.sort,creator_id:e.user_id}})}async deleteEnviroment(e){if(6!==await this.userService.getUserProjectRole(e))throw new c.HttpException("未授权",c.HttpStatus.OK);const t=await this.prismaService.projectEnviroments.findUnique({where:{project_env_id:{project_id:e.project_id,env_id:e.env_id}}});if(!(0,p.isPlainObject)(t))throw new c.HttpException("环境已被删除",c.HttpStatus.OK);return await this.prismaService.projectEnviroments.delete({where:{project_env_id:{project_id:e.project_id,env_id:e.env_id}}})}async getEnviroment(e){const t=await this.userService.getUserProjectRole(e);if(![4,6].includes(t))throw new c.HttpException("未授权",c.HttpStatus.OK);return await this.prismaService.projectEnviroments.findUnique({where:{project_env_id:{project_id:e.project_id,env_id:e.env_id}}})}async updateEnviroment(e){if(6!==await this.userService.getUserProjectRole(e))throw new c.HttpException("未授权",c.HttpStatus.OK);const t=(0,p.pick)(e,["project_id","env_id","name","auth_type","env_urls","icon","variables","sort"]);return await this.prismaService.projectEnviroments.update({where:{project_env_id:{project_id:e.project_id,env_id:e.env_id}},data:t})}async initData(e){const t=l.INIT_DATA.map((t=>({...t,project_id:e})));await this.prismaService.projectEnviroments.createMany({data:t})}};t.EnvsService=f,t.EnvsService=f=s([(0,c.Injectable)(),a(1,(0,c.Inject)((0,c.forwardRef)((()=>u.UserService)))),n("design:paramtypes",["function"==typeof(r=void 0!==d.PrismaService&&d.PrismaService)?r:Object,"function"==typeof(o=void 0!==u.UserService&&u.UserService)?o:Object])],f)},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.INIT_DATA=void 0;const i={default:""},r=["#fa8c16","#eb2f96","#4caf50","#9373ee","#32c2c2","#f9541c","#2190ff","#2f54eb"];t.INIT_DATA=[{project_id:null,env_id:"dev",name:"开发环境",auth_type:2,env_urls:i,icon:{text:"开",color:r[0]},variables:[],sort:1},{project_id:null,env_id:"test",name:"测试环境",auth_type:2,env_urls:i,icon:{text:"测",color:r[1]},variables:[],sort:2},{project_id:null,env_id:"prod",name:"正式环境",auth_type:2,env_urls:i,icon:{text:"正",color:r[2]},variables:[],sort:3},{project_id:null,env_id:"local_mock",name:"本地Mock",auth_type:2,env_urls:i,icon:{text:"本",color:r[3]},variables:[],sort:4},{project_id:null,env_id:"remote_mock",name:"云端Mock",auth_type:2,env_urls:i,icon:{text:"云",color:r[4]},variables:[],sort:5}]},function(e,t,i){var r,o,s=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.MocksService=void 0;const c=i(3),d=i(17),p=i(7),u=i(37),l=i(6);let f=class{constructor(e,t){this.prismaService=e,this.userService=t}async getMockDetail(e){if((0,p.isEmpty)(e))throw new c.HttpException("请求参数无效",c.HttpStatus.BAD_REQUEST);return await this.prismaService.projectMockConfigs.findUnique({where:{project_id:e}})}async updateMock(e){const t=e?.project_id,i=(0,p.pick)(e??{},["mock_engine","default_mock_type","use_cloud_mock","use_built_in"]);if((0,p.isEmpty)(t))throw new c.HttpException("请求参数无效",c.HttpStatus.BAD_REQUEST);if(6!==await this.userService.getUserProjectRole(e))throw new c.HttpException("未授权",c.HttpStatus.OK);return await this.prismaService.projectMockConfigs.update({where:{project_id:t},data:i})}async initData(e){const t={...u.INIT_MOCK_DATA,project_id:e};await this.prismaService.projectMockConfigs.create({data:t})}};t.MocksService=f,t.MocksService=f=s([(0,c.Injectable)(),a(1,(0,c.Inject)((0,c.forwardRef)((()=>l.UserService)))),n("design:paramtypes",["function"==typeof(r=void 0!==d.PrismaService&&d.PrismaService)?r:Object,"function"==typeof(o=void 0!==l.UserService&&l.UserService)?o:Object])],f)},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.INIT_MOCK_DATA=void 0,t.INIT_MOCK_DATA={mock_engine:1,default_mock_type:1,use_cloud_mock:-1,use_built_in:1}},function(e,t,i){var r,o,s=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ServersService=void 0;const c=i(3),d=i(17),p=i(7),u=i(6),l=i(39),f=i(25);let v=class{constructor(e,t){this.prismaService=e,this.userService=t}async getServers(e){return await this.prismaService.projectServers.findMany({select:{project_id:!0,server_id:!0,name:!0,create_time:!0},where:{project_id:e},orderBy:{create_time:"asc"}})}async saveServer(e){if(6!==await this.userService.getUserProjectRole(e))throw new c.HttpException("未授权",c.HttpStatus.OK);return await this.prismaService.projectServers.upsert({where:{project_server_id:{project_id:e.project_id,server_id:e.server_id}},update:{name:e.name},create:{project_id:e.project_id,server_id:e.server_id,name:e.name,create_time:(0,f.default)().format()}})}async deleteServer(e){if(6!==await this.userService.getUserProjectRole(e))throw new c.HttpException("未授权",c.HttpStatus.OK);return await this.prismaService.projectServers.deleteMany({where:{project_id:e.project_id,server_id:e.server_id}})}async updateServer(e){if(6!==await this.userService.getUserProjectRole(e))throw new c.HttpException("未授权",c.HttpStatus.OK);const t=(0,p.pick)(e,["name"]);return await this.prismaService.projectServers.update({where:{project_server_id:{project_id:e.project_id,server_id:e.server_id}},data:t})}async initData(e){const t={...l.INIT_SERVER_DATA,create_time:(0,f.default)().format(),project_id:e};await this.prismaService.projectServers.create({data:t})}};t.ServersService=v,t.ServersService=v=s([(0,c.Injectable)(),a(1,(0,c.Inject)((0,c.forwardRef)((()=>u.UserService)))),n("design:paramtypes",["function"==typeof(r=void 0!==d.PrismaService&&d.PrismaService)?r:Object,"function"==typeof(o=void 0!==u.UserService&&u.UserService)?o:Object])],v)},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.INIT_SERVER_DATA=void 0,t.INIT_SERVER_DATA={server_id:"default",name:"默认服务"}},function(e,t,i){var r,o,s,n=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.NotificationService=void 0;const c=i(3),d=i(17),p=i(7),u=i(25),l=i(28),f=i(10);let v=class{constructor(e,t,i){this.prismaService=e,this.configService=t,this.jwtService=i}async getNotifyList(e){let t="";try{const i=this.jwtService.verify(e,{secret:this.configService.get("JWT_ACCESS_SECRET")});t=i?.sub}catch(e){}const i=await this.prismaService.notification.findMany({where:{OR:[{type:1},{type:2,uid:t}]},orderBy:{db_id:"desc"}});return(0,p.isArray)(i)?i:[]}async addNodify(e){const{type:t=2,...i}=e,r={...i,send_time:(0,u.default)().format(),type:t};return await this.prismaService.notification.create({data:r})}async clearNotification(e){return await this.prismaService.notification.deleteMany({where:{uid:e}})}};t.NotificationService=v,t.NotificationService=v=n([(0,c.Injectable)(),a("design:paramtypes",["function"==typeof(r=void 0!==d.PrismaService&&d.PrismaService)?r:Object,"function"==typeof(o=void 0!==f.ConfigService&&f.ConfigService)?o:Object,"function"==typeof(s=void 0!==l.JwtService&&l.JwtService)?s:Object])],v)},(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SAMPLE_APIS=void 0;const r=i(42),o=i(43),s=i(44),n=i(45),a=i(46),c=i(47),d=i(48);t.SAMPLE_APIS=[{data:r},{data:o,children:[{data:s},{data:n},{data:a},{data:c},{data:d}]}]},e=>{e.exports=JSON.parse('{"node_type":"interface","id":null,"parent_id":"0","name":"欢迎使用Hapydev","sort":16,"version":1,"data_type":"document","status":1,"data":{"description":"## 欢迎使用Hapydev\\nHapydev是一款高效的专业测试工具，支持业内主流的接口协议，使用受众为整个研发技术团队，主要使用者为前端开发、后端开发、测试人员。\\n\\nHapydev软件致力于消除不同应用工具之间的数据交换壁垒。通过整合Fiddler/Charles，Postman，JMeter，Selenium等工具的核心功能，实现数据统一管理并串联研发过程中的关键环节，使得研发团队能够摆脱技术工具选择的限制，真正实现以赋能业务为目标的技术创新。\\n\\n## 软件特点：\\n\\n- 无需登陆，无需联网可使用软件绝大部分功能\\n\\n- 零代码实现场景复杂的自动化测试。支持集成测试，数据驱动测试，回归测试等功能。\\n\\n- 支持多种方式与第三方系统进行融合，同时支持与jira，tapd或jekins等第三方平台集成。\\n\\n- 支持grpc一元/二元，单向/双向调用，支持proto解析，及服务反射等功能。\\n\\n- 面向底层实现软件功能逻辑，调试输出的信息更精准，帮助开发快速定位问题。\\n\\n- 集成了丰富的脚本库，支持加密解密，自动验证token等功能\\n\\n- 多平台支持：即将支持 Windows、macOS、Linux 等主流操作系统。\\n\\n\\n更详细使用方法，请跳转[帮助中心](https://help.hapydev.com) \\n\\n\\n\\n"},"project_id":null}')},e=>{e.exports=JSON.parse('{"node_type":"interface","id":"8c63a295-2c06-48e6-937e-5f3481f78ae9","parent_id":"0","name":"示例项目","sort":27,"version":1,"data_type":"folder","status":1,"data":{"server_id":"inherit","request":{"auth":{"type":"inherit"},"pre_tasks":[{"type":"custom_script","enabled":1,"data":""}],"post_tasks":[{"type":"custom_script","enabled":1,"data":""}]},"description":"","status":"developing"},"project_id":"01e83681-d9e5-4b44-943f-01ae5f1286e6"}')},e=>{e.exports=JSON.parse('{"node_type":"interface","id":"c6597026-0592-4ac7-9e90-79bc69e5cda8","parent_id":"0","name":"查询宠物信息","sort":22,"version":1,"data_type":"http","status":1,"data":{"request":{"url":"/pet/:petId","method":"GET","auth":{"type":"inherit"},"headers":{"sys_header":[],"parameter":[]},"params":{"parameter":[],"restful":[{"is_used":1,"name":"petId","value":"123","description":"宠物ID"}]},"body":{"mode":"none","parameter":[],"raw":"","raw_schema":{"type":"object"},"binary":null},"cookies":[],"pre_tasks":[{"type":"custom_script","enabled":1,"data":""}],"post_tasks":[{"type":"custom_script","enabled":1,"data":""}]},"examples":[{"name":"成功","http_code":200,"description":"","content_type":"JSON","schema":{"type":"object"},"raw":"{}"}],"description":"","status":"developing"},"project_id":"01e83681-d9e5-4b44-943f-01ae5f1286e6","create_time":"2024-12-13T01:24:32+08:00","creator_id":"NO_LOGIN","update_time":"2024-12-13T01:25:24+08:00","updater_id":"NO_LOGIN"}')},e=>{e.exports=JSON.parse('{"node_type":"interface","id":null,"parent_id":null,"name":"新建宠物信息","sort":21,"version":1,"data_type":"http","status":1,"data":{"request":{"url":"/pet","method":"POST","auth":{"type":"inherit"},"headers":{"sys_header":[{"name":"User-Agent","field_type":"text","value":"Hapydev-Runtime/1.0.0","data_type":"string","is_required":1,"is_used":1,"description":""},{"name":"Accept","field_type":"text","value":"*/*","data_type":"string","is_required":1,"is_used":1,"description":""},{"name":"Accept-Encoding","field_type":"text","value":"gzip, deflate, br","data_type":"string","is_required":1,"is_used":1,"description":""},{"name":"Connection","field_type":"text","data_type":"string","value":"keep-alive","is_required":1,"is_used":1,"description":""}],"parameter":[]},"params":{"parameter":[],"restful":[]},"body":{"mode":"json","parameter":[{"name":"name","field_type":"text","value":"huahua","data_type":"string","is_required":1,"is_used":1,"description":"宠物名"},{"name":"status","field_type":"text","value":"sold","data_type":"string","is_required":1,"is_used":1,"description":"宠物销售状态"}],"raw":"","raw_schema":{"type":"object"},"binary":null},"cookies":[],"pre_tasks":[{"type":"custom_script","enabled":1,"data":""}],"post_tasks":[{"type":"custom_script","enabled":1,"data":""}]},"examples":[{"name":"成功","http_code":200,"description":"","content_type":"JSON","schema":{"type":"object","properties":{"code":{"type":"string"},"data":{"$ref":"#/definitions/fc616b95-3c58-4d9b-84bb-3909792b3848"}},"x_hapydev_orders":["code","data"],"required":[]},"raw":"{\\n  \\"code\\": 0,\\n  \\"data\\": {\\n     \\"id\\": 3,\\n    \\"name\\": \\"Hello Kity\\",\\n    \\"image_url\\": \\"http://dummyimage.com/400x400\\",\\n    \\"category\\": {\\n      \\"id\\": 71,\\n      \\"name\\": \\"Cat\\"\\n    },\\n    \\"tags\\": [\\n      {\\n        \\"id\\": 22,\\n        \\"name\\": \\"Cat\\"\\n      }\\n    ],\\n    \\"status\\": \\"sold\\"\\n  }\\n}"}],"description":"","status":"developing"},"project_id":null}')},e=>{e.exports=JSON.parse('{"node_type":"interface","id":null,"parent_id":"0","name":"更新宠物信息","sort":3,"version":1,"data_type":"http","status":1,"data":{"request":{"url":"/pet/:petId","method":"PUT","auth":{"type":"inherit"},"headers":{"sys_header":[{"name":"User-Agent","field_type":"text","value":"Hapydev-Runtime/1.0.0","data_type":"string","is_required":1,"is_used":1,"description":""},{"name":"Accept","field_type":"text","value":"*/*","data_type":"string","is_required":1,"is_used":1,"description":""},{"name":"Accept-Encoding","field_type":"text","value":"gzip, deflate, br","data_type":"string","is_required":1,"is_used":1,"description":""},{"name":"Connection","field_type":"text","data_type":"string","value":"keep-alive","is_required":1,"is_used":1,"description":""}],"parameter":[]},"params":{"parameter":[],"restful":[{"is_used":1,"name":"petId","value":"122","description":"宠物ID"}]},"body":{"mode":"json","parameter":[],"raw":"{\\n    \\"name\\":\\"kity\\"\\n}","raw_schema":{"type":"object"},"binary":null},"cookies":[],"pre_tasks":[{"type":"custom_script","enabled":1,"data":""}],"post_tasks":[{"type":"custom_script","enabled":1,"data":""}]},"examples":[{"name":"成功","http_code":200,"description":"","content_type":"JSON","schema":{"type":"object"},"raw":"{}"}],"description":"","status":"developing"},"project_id":null}')},e=>{e.exports=JSON.parse('{"node_type":"interface","id":"866869c0-3dae-4106-ba0c-0fdf606e8af5","parent_id":"0","name":"删除宠物信息","sort":24,"version":1,"data_type":"http","status":1,"data":{"request":{"url":"/pet/:petId","method":"DELETE","auth":{"type":"inherit"},"headers":{"sys_header":[{"name":"User-Agent","field_type":"text","value":"Hapydev-Runtime/1.0.0","data_type":"string","is_required":1,"is_used":1,"description":""},{"name":"Accept","field_type":"text","value":"*/*","data_type":"string","is_required":1,"is_used":1,"description":""},{"name":"Accept-Encoding","field_type":"text","value":"gzip, deflate, br","data_type":"string","is_required":1,"is_used":1,"description":""},{"name":"Connection","field_type":"text","data_type":"string","value":"keep-alive","is_required":1,"is_used":1,"description":""}],"parameter":[]},"params":{"parameter":[],"restful":[{"is_used":1,"name":"petId","value":"123","description":"宠物ID"}]},"body":{"mode":"none","parameter":[],"raw":"","raw_schema":{"type":"object"},"binary":null},"cookies":[],"pre_tasks":[{"type":"custom_script","enabled":1,"data":""}],"post_tasks":[{"type":"custom_script","enabled":1,"data":""}]},"examples":[{"name":"成功","http_code":200,"description":"","content_type":"JSON","schema":{"type":"object"},"raw":"{}"}],"description":"","status":"developing"},"project_id":"01e83681-d9e5-4b44-943f-01ae5f1286e6"}')},e=>{e.exports=JSON.parse('{"node_type":"interface","id":"efdd20d6-647b-455e-8d5e-97688890abb1","parent_id":"0","name":"根据状态查找宠物列表","sort":26,"version":1,"data_type":"http","status":1,"data":{"request":{"url":"/pet/findBgStatus?status=sold","method":"GET","auth":{"type":"inherit"},"headers":{"sys_header":[{"name":"User-Agent","field_type":"text","value":"Hapydev-Runtime/1.0.0","data_type":"string","is_required":1,"is_used":1,"description":""},{"name":"Accept","field_type":"text","value":"*/*","data_type":"string","is_required":1,"is_used":1,"description":""},{"name":"Accept-Encoding","field_type":"text","value":"gzip, deflate, br","data_type":"string","is_required":1,"is_used":1,"description":""},{"name":"Connection","field_type":"text","data_type":"string","value":"keep-alive","is_required":1,"is_used":1,"description":""}],"parameter":[]},"params":{"parameter":[{"name":"status","field_type":"text","value":"sold","data_type":"string","is_required":1,"is_used":1,"description":"宠物销售状态"}],"restful":[]},"body":{"mode":"none","parameter":[],"raw":"","raw_schema":{"type":"object"},"binary":null},"cookies":[],"pre_tasks":[{"type":"custom_script","enabled":1,"data":""}],"post_tasks":[{"type":"custom_script","enabled":1,"data":""}]},"examples":[{"name":"成功","http_code":200,"description":"","content_type":"JSON","schema":{"type":"object","properties":{"code":{"type":"string"},"data":{"type":"array","items":{"$ref":"#/definitions/fc616b95-3c58-4d9b-84bb-3909792b3848"}}},"x_hapydev_orders":["code","data"],"required":[]},"raw":"{\\n    \\"code\\": 0,\\n    \\"data\\": [\\n        {\\n            \\"name\\": \\"Hello Kity\\",\\n            \\"image_url\\": \\"http://dummyimage.com/400x400\\",\\n            \\"id\\": 3,\\n            \\"category\\": {\\n                \\"id\\": 71,\\n                \\"name\\": \\"Cat\\"\\n            },\\n            \\"tags\\": [\\n                {\\n                    \\"id\\": 22,\\n                    \\"name\\": \\"Cat\\"\\n                }\\n            ],\\n            \\"status\\": \\"sold\\"\\n        },\\n        {\\n            \\"name\\": \\"White Dog\\",\\n            \\"image_url\\":  \\"http://dummyimage.com/400x400\\",\\n            \\"id\\": 3,\\n            \\"category\\": {\\n                \\"id\\": 71,\\n                \\"name\\": \\"Dog\\"\\n            },\\n            \\"tags\\": [\\n                {\\n                    \\"id\\": 22,\\n                    \\"name\\": \\"Dog\\"\\n                }\\n            ],\\n            \\"status\\": \\"sold\\"\\n        }\\n    ]\\n}"}],"description":"","status":"developing"},"project_id":"01e83681-d9e5-4b44-943f-01ae5f1286e6"}')},function(e,t,i){var r,o,s,n,a,c=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ApisService=void 0;const u=i(3),l=i(7),f=i(6),v=i(9),_=i(19),h=i(17),y=i(25),m=i(50);let S=class{constructor(e,t,i,r,o){this.fileStoreService=e,this.prismaService=t,this.redisService=i,this.userService=r,this.toolsService=o}async getProjectBucketName(e){const t=`PROJECT_BUCKET${e}`,i=await this.redisService.get(t);if((0,l.isString)(i))return i;const r=await this.prismaService.projects.findUnique({where:{project_id:e},select:{bucket_id:!0}});return await this.redisService.set(t,r.bucket_id),r.bucket_id}async saveApiData(e,t){const{project_id:i,bucket_name:r,user_id:o}=t,s=JSON.stringify(e.data),n=(0,y.default)().format(),a=await this.fileStoreService.saveData(r,e.id,s),c={...(0,l.pick)(e,["parent_id","name","sort"]),etag:a.etag,update_time:n,updater_id:o,version:a?.versionId,status:1},d={...(0,l.pick)(e,["id","parent_id","name","data_type","sort"]),db_id:this.toolsService.getUniqueID(),project_id:i,etag:a.etag,version:a.versionId,create_time:n,creator_id:o,update_time:null,updater_id:null,status:1};(0,l.isUndefined)(e?.data?.request?.url)||(c.url=e?.data?.request?.url,d.url=e?.data?.request?.url),(0,l.isUndefined)(e?.data?.request?.method)||(c.method=e?.data?.request?.method,d.method=e?.data?.request?.method);return{...await this.prismaService.apiBase.upsert({where:{id:e.id},update:c,create:d}),data:e.data}}async saveApi(e){const t=await this.userService.getUserProjectRole(e);if(![2,6].includes(t))throw new u.HttpException("未授权",u.HttpStatus.OK);const i=await this.prismaService.apiBase.findUnique({where:{project_id:e.project_id,id:e.id}});if((0,l.isString)(i?.locker_id))throw new u.HttpException("当前接口已锁定，操作无效",u.HttpStatus.OK);const r=await this.getProjectBucketName(e.project_id);return await this.saveApiData(e,{project_id:e.project_id,bucket_name:r,user_id:e.user_id})}async getApiDetail(e){const t=await this.userService.getUserProjectRole(e);if(![4,6].includes(t))throw new u.HttpException("未授权",u.HttpStatus.OK);const i=await this.prismaService.apiBase.findUnique({where:{id:e.id}});if((0,l.isNull)(i)||[-1,-99].includes(i?.status))throw new u.HttpException("数据不存在或已被删除",u.HttpStatus.OK);const r=await this.getProjectBucketName(e.project_id),o=await this.fileStoreService.getData(r,e.id);return{...i,data:o}}async batchGetApiDetail(e){const t=await this.userService.getUserProjectRole(e),i=await this.getProjectBucketName(e.project_id);if(![4,6].includes(t))throw new u.HttpException("未授权",u.HttpStatus.OK);if(e.ids?.length>100)throw new u.HttpException("单次最大不能查询超100条数据",u.HttpStatus.OK);const r=await this.prismaService.apiBase.findMany({where:{id:{in:e.ids}}}),o=[];for(const e of r){const t=await this.fileStoreService.getData(i,e.id);null!==t&&o.push({...e,data:t})}return o}async getApiDescribes(e){const t=await this.userService.getUserProjectRole(e);if(![4,6].includes(t))throw new u.HttpException("未授权",u.HttpStatus.OK);return await this.prismaService.apiBase.findMany({select:{id:!0,name:!0,etag:!0,locker_id:!0,version:!0,data_type:!0,status:!0,sort:!0,method:!0,url:!0},where:{project_id:e.project_id,status:{in:[1,2,-1]}}})}async deleteApi(e){const t=await this.userService.getUserProjectRole(e);if(![2,6].includes(t))throw new u.HttpException("未授权",u.HttpStatus.OK);const i=await this.prismaService.apiBase.findUnique({where:{project_id:e.project_id,id:e.id}});if((0,l.isString)(i?.locker_id))throw new u.HttpException("当前接口已锁定，操作无效",u.HttpStatus.OK);return await this.prismaService.apiBase.update({where:{id:e.id},data:{status:-1}}),!0}async batchDeleteApi(e){const t=await this.userService.getUserProjectRole(e);if(![2,6].includes(t))throw new u.HttpException("未授权",u.HttpStatus.OK);const i=await this.prismaService.apiBase.findMany({where:{id:{in:e.ids}},select:{locker_id:!0}});let r=0;for(const e of i)(0,l.isString)(e?.locker_id)&&r++;if(r>0)throw new u.HttpException("尝试删除已锁定的接口，操作无效",u.HttpStatus.OK);return await this.prismaService.apiBase.updateMany({where:{id:{in:e.ids},locker_id:null},data:{status:-1}})}async sortApiList(e){const t=await this.userService.getUserProjectRole(e);if(![2,6].includes(t))throw new u.HttpException("未授权",u.HttpStatus.OK);if(await this.prismaService.apiBase.update({where:{id:e.sort_id},data:{parent_id:e.new_parent_id}}),!(0,l.isArray)(e.new_sort_list))return!0;for(const t of e.new_sort_list)await this.prismaService.apiBase.update({where:{id:t.id},data:{sort:t.sort}});return!0}async batchSaveApi(e){const t=await this.userService.getUserProjectRole(e);if(![2,6].includes(t))throw new u.HttpException("未授权",u.HttpStatus.OK);if(!(0,l.isArray)(e.api_list)||(0,l.isEmpty)(e.api_list))return!1;const i=await this.getProjectBucketName(e.project_id);for(const t of e.api_list)(0,l.isString)(t?.locker_id)||await this.saveApiData(t,{project_id:e.project_id,user_id:e.user_id,bucket_name:i});return!0}async lockApi(e){const t=await this.userService.getUserProjectRole(e);if(![2,6].includes(t))throw new u.HttpException("未授权",u.HttpStatus.OK);const i=await this.prismaService.apiBase.findUnique({where:{project_id:e.project_id,id:e.id}});if((0,l.isString)(i?.locker_id)&&i.locker_id!==e.user_id)throw new u.HttpException("当前接口已被其他用户锁定，您无权操作",u.HttpStatus.OK);return await this.prismaService.apiBase.update({where:{id:e.id},data:{locker_id:e.user_id}}),{locker_id:e.user_id}}async unLockApi(e){const t=await this.userService.getUserProjectRole(e);if(![2,6].includes(t))throw new u.HttpException("未授权",u.HttpStatus.OK);const i=await this.prismaService.apiBase.findUnique({where:{project_id:e.project_id,id:e.id}});if((0,l.isString)(i?.locker_id)&&i.locker_id!==e.user_id)throw new u.HttpException("当前接口已被其他用户锁定，您无权操作",u.HttpStatus.OK);return await this.prismaService.apiBase.update({where:{project_id:e.project_id,id:e.id},data:{locker_id:null}}),{locker_id:null}}};t.ApisService=S,t.ApisService=S=c([(0,u.Injectable)(),p(3,(0,u.Inject)((0,u.forwardRef)((()=>f.UserService)))),d("design:paramtypes",["function"==typeof(r=void 0!==m.FileStoreService&&m.FileStoreService)?r:Object,"function"==typeof(o=void 0!==h.PrismaService&&h.PrismaService)?o:Object,"function"==typeof(s=void 0!==v.RedisService&&v.RedisService)?s:Object,"function"==typeof(n=void 0!==f.UserService&&f.UserService)?n:Object,"function"==typeof(a=void 0!==_.ToolsService&&_.ToolsService)?a:Object])],S)},function(e,t,i){var r,o=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.FileStoreService=void 0;const n=i(3),a=i(10),c=i(20),d=i(51),p=i(51),u=i(52);var l=i(53);let f=class{constructor(e){this.configService=e,this.rootPath=e.get("FILES_ROOT_PATH")}mkdirsSync(e){return!!p.existsSync(e)||(this.mkdirsSync(u.dirname(e))?(p.mkdirSync(e),!0):void 0)}async saveData(e,t,i){const r=u.join(this.rootPath,e,t);this.mkdirsSync(r);const o=u.join(r,"latest"),s=(0,c.strToMd5)(i);return p.writeFileSync(o,i),{versionId:null,etag:s}}async saveBuffer(e,t,i){const r=u.join(this.rootPath,e);this.mkdirsSync(r);const o=u.join(r,t),s=l(i);return await p.writeFile(o,i,(e=>{})),{versionId:null,etag:s}}async getData(e,t,i){const r=u.join(this.rootPath,e,t,"latest");if(!0!==p.existsSync(r))return null;const o=p.readFileSync(r).toString();try{return JSON.parse(o)}catch(e){}return o}getBuffer(e,t,i){const r=u.join(this.rootPath,e,t);return!0!==p.existsSync(r)?null:(0,d.createReadStream)(r)}async deleteData(e,t,i){const r=u.join(this.rootPath,e,t,"latest");return!0!==p.existsSync(r)?null:p.lstatSync(r).isFile()?(p.unlinkSync(r),!0):(p.rmSync(r,{recursive:!0,force:!0}),!0)}};t.FileStoreService=f,t.FileStoreService=f=o([(0,n.Injectable)(),s("design:paramtypes",["function"==typeof(r=void 0!==a.ConfigService&&a.ConfigService)?r:Object])],f)},e=>{e.exports=require("fs")},e=>{e.exports=require("path")},e=>{e.exports=require("md5")},function(e,t,i){var r,o,s,n,a=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.TeamService=void 0;const p=i(3),u=i(17),l=i(7),f=i(29),v=i(40),_=i(19),h=i(25);let y=class{constructor(e,t,i,r){this.prismaService=e,this.toolsService=t,this.projectService=i,this.notificationService=r}async getTeamListByUserId(e){const t=await this.prismaService.userTeams.findMany({select:{team_id:!0,role:!0,nick_name:!0,join_time:!0,team:{select:{name:!0,description:!0,expire_date:!0}}},where:{uid:e},orderBy:{team:{db_id:"asc"}}});return(0,l.isArray)(t)?t.map((t=>({team_id:t.team_id,team_name:t.team.name,role:t.role,nick_name:t.nick_name,description:t.team.description,expire_date:t.team.expire_date,join_time:t?.join_time,user_id:e}))):[]}async createTeam(e){const{user_id:t,team_id:i,team_name:r,description:o}=e;if((0,l.isEmpty)(r))throw new p.HttpException("团队名称不能为空",p.HttpStatus.BAD_REQUEST);return await this.prismaService.teams.create({data:{db_id:this.toolsService.getUniqueID(),team_id:i,name:r,owner_id:t,description:o,product_type:1,create_time:(0,h.default)().format()}}),await this.addUserToTeam({uid:t,team_id:i,role:4}),await this.notificationService.addNodify({uid:t,title:"团队消息",content:`团队 ${r} 创建成功`,type:2}),{team_id:i}}async deleteTeam(e){return await this.prismaService.teams.delete({where:{team_id:e}})}async disbandTeam(e){const t=await this.getTeamInfo(e.team_id);if(!t)throw new p.HttpException("团队信息不存在",p.HttpStatus.BAD_REQUEST);if(t.owner_id!==e.user_id)throw new p.HttpException("您不是团队所有人",p.HttpStatus.BAD_REQUEST);if(e.team_name!==t.name)throw new p.HttpException("团队名称输入错误",p.HttpStatus.BAD_REQUEST);const i=await this.prismaService.projects.findMany({select:{project_id:!0},where:{team_id:e.team_id}});for(const{project_id:e}of i)await this.projectService.forceDeleteProject(e);await this.deleteTeamUsers(e.team_id);const r=await this.deleteTeam(e.team_id);return await this.notificationService.addNodify({uid:e.user_id,title:"团队消息",content:`团队 ${t.name} 已解散`,type:2}),r?.team_id}async addUserToTeam(e){const t=await this.prismaService.userTeams.findUnique({where:{team_id_uid:{team_id:e.team_id,uid:e.uid}}});return(0,l.isPlainObject)(t)?t:await this.prismaService.userTeams.create({data:{...e,join_time:(0,h.default)().format()}})}async deleteTeamUsers(e){return await this.prismaService.userTeams.deleteMany({where:{team_id:e}})}async getTeamInfo(e){const t=await this.prismaService.teams.findFirst({where:{team_id:e}});if(!t)throw new p.HttpException("团队信息不存在",p.HttpStatus.BAD_REQUEST);return t}async updateTeamInfo(e,t){const i=(0,l.pick)(t,["name","description","owner_id"]);return await this.prismaService.teams.update({where:{team_id:e},data:i})}async transferTeam(e){if((await this.getTeamInfo(e.team_id)).owner_id!==e.old_owner_id)throw new p.HttpException("您不是团队所有人，操作失败",p.HttpStatus.BAD_REQUEST);if(e.new_owner_id===e.old_owner_id)throw new p.HttpException("您不能将团队移交给自己",p.HttpStatus.BAD_REQUEST);const t=await this.prismaService.users.findUnique({where:{uid:e.new_owner_id}});if((0,l.isEmpty)(e.new_owner_id)||!t)throw new p.HttpException("团队接收方用户不存在",p.HttpStatus.BAD_REQUEST);await this.prismaService.userTeams.update({where:{team_id_uid:{team_id:e.team_id,uid:e.old_owner_id}},data:{role:3}}),await this.prismaService.userTeams.update({where:{team_id_uid:{team_id:e.team_id,uid:e.new_owner_id}},data:{role:4}});return await this.updateTeamInfo(e.team_id,{owner_id:e.new_owner_id})}async updateNickName(e){return await this.prismaService.userTeams.update({where:{team_id_uid:{team_id:e.team_id,uid:e.user_id}},data:{nick_name:e.nick_name}})}async getAllUsers(e){const{user_id:t,team_id:i}=e,r=await this.prismaService.userTeams.findUnique({where:{team_id_uid:{team_id:i,uid:t}}});if((0,l.isEmpty)(r))throw new p.HttpException("无团队成员权限",p.HttpStatus.BAD_REQUEST);return await this.prismaService.userTeams.findMany({where:{team_id:i},select:{team_id:!0,uid:!0,nick_name:!0,role:!0,join_time:!0,user:{select:{avatar:!0,nick_name:!0,email:!0,phone:!0,last_login_time:!0}}},orderBy:{join_time:"asc"}})}async exitTeam(e){const{user_id:t,team_id:i}=e,r=await this.prismaService.userTeams.findUnique({where:{team_id_uid:{team_id:i,uid:t}}});if((0,l.isEmpty)(r))throw new p.HttpException("无团队成员权限",p.HttpStatus.BAD_REQUEST);if(4===r?.role)throw new p.HttpException("您是团队所有人，操作无效",p.HttpStatus.BAD_REQUEST);const o=await this.prismaService.projects.findMany({where:{team_id:i},select:{project_id:!0}});if((0,l.isArray)(o))for(const e of o)await this.prismaService.userProjects.deleteMany({where:{project_id:e.project_id,uid:t}});return await this.prismaService.userTeams.delete({where:{team_id_uid:{team_id:i,uid:t}}})}async removeUser(e){const{user_id:t,team_id:i,target_user_id:r}=e,o=await this.prismaService.userTeams.findUnique({where:{team_id_uid:{team_id:i,uid:t}}});if((0,l.isEmpty)(o))throw new p.HttpException("无团队成员权限",p.HttpStatus.BAD_REQUEST);if(4!==o?.role&&3!==o?.role)throw new p.HttpException("您不是团队所有人或管理员，操作无效",p.HttpStatus.BAD_REQUEST);if(4===(await this.prismaService.userTeams.findUnique({where:{team_id_uid:{team_id:i,uid:r}}})).role)throw new p.HttpException("团队所有者无法直接删除",p.HttpStatus.BAD_REQUEST);const s=await this.prismaService.projects.findMany({where:{team_id:i},select:{project_id:!0}});if((0,l.isArray)(s))for(const e of s)await this.prismaService.userProjects.deleteMany({where:{project_id:e.project_id,uid:r}});return await this.prismaService.userTeams.delete({where:{team_id_uid:{team_id:i,uid:r}}})}async updateUserNickName(e){const{user_id:t,team_id:i,target_user_id:r,nick_name:o}=e,s=await this.prismaService.userTeams.findUnique({where:{team_id_uid:{team_id:i,uid:t}}});if((0,l.isEmpty)(s))throw new p.HttpException("无团队成员权限",p.HttpStatus.BAD_REQUEST);if(4!==s?.role&&3!==s?.role)throw new p.HttpException("您不是团队所有人或管理员，操作无效",p.HttpStatus.BAD_REQUEST);return await this.prismaService.userTeams.update({where:{team_id_uid:{team_id:i,uid:r}},data:{nick_name:o}})}async getUserRoles(e){const{user_id:t,team_id:i,target_user_id:r}=e,o=await this.prismaService.userTeams.findUnique({where:{team_id_uid:{team_id:i,uid:t}}});if((0,l.isEmpty)(o))throw new p.HttpException("无团队成员权限",p.HttpStatus.BAD_REQUEST);if(4!==o?.role&&3!==o?.role)throw new p.HttpException("您不是团队所有人或管理员，操作无效",p.HttpStatus.BAD_REQUEST);const s=await this.prismaService.userTeams.findUnique({where:{team_id_uid:{team_id:i,uid:r}},select:{role:!0}}),n=(await this.prismaService.projects.findMany({where:{team_id:i},select:{project_id:!0}})).map((e=>e.project_id)),a=await this.prismaService.userProjects.findMany({select:{project_id:!0,role:!0},where:{uid:r,project_id:{in:n}}}),c={};for(const e of a)c[e?.project_id]=e?.role;return{teamRole:s?.role,projectRoles:c}}async updateUserRoles(e){const{user_id:t,team_id:i,target_user_id:r,team_role:o,project_roles:s}=e,n=await this.prismaService.userTeams.findUnique({where:{team_id_uid:{team_id:i,uid:t}}});if((0,l.isEmpty)(n))throw new p.HttpException("无团队成员权限",p.HttpStatus.BAD_REQUEST);if(4!==n?.role&&3!==n?.role)throw new p.HttpException("您不是团队所有人或管理员，操作无效",p.HttpStatus.BAD_REQUEST);await this.prismaService.userTeams.update({where:{team_id_uid:{team_id:i,uid:r}},data:{role:o}});const a=[];Object.entries(s).forEach((([e,t])=>{a.push({project_id:e,role:t})}));for(const e of a)await this.prismaService.userProjects.upsert({where:{project_id_uid:{project_id:e.project_id,uid:r}},update:{role:e.role},create:{project_id:e.project_id,uid:r,role:e.role,join_time:(0,h.default)().format()}});return!0}};t.TeamService=y,t.TeamService=y=a([(0,p.Injectable)(),d(2,(0,p.Inject)((0,p.forwardRef)((()=>f.ProjectService)))),c("design:paramtypes",["function"==typeof(r=void 0!==u.PrismaService&&u.PrismaService)?r:Object,"function"==typeof(o=void 0!==_.ToolsService&&_.ToolsService)?o:Object,"function"==typeof(s=void 0!==f.ProjectService&&f.ProjectService)?s:Object,"function"==typeof(n=void 0!==v.NotificationService&&v.NotificationService)?n:Object])],y)},e=>{e.exports=require("class-validator")},(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Send=void 0;const r=i(57),o=i(58);t.Send=e=>(0,r.from)(e).pipe((0,r.map)((e=>(0,o.toSuccess)({data:e}))),(0,r.catchError)((e=>(0,r.of)({code:10001,message:e.message.toString()}))))},e=>{e.exports=require("rxjs")},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.toError=t.toSuccess=void 0;t.toSuccess=e=>({code:e?.code??1e4,message:e?.message?.toString(),data:e?.data});t.toError=e=>({code:e?.code??10001,message:e?.message?.toString()})},(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PUBLICKEY=t.Public=void 0;const r=i(3),o="PUBLICKEY";t.PUBLICKEY=o;t.Public=()=>(0,r.SetMetadata)(o,!0)},function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CREATE_USER=void 0;const s=i(55);class n{}t.CREATE_USER=n,r([(0,s.IsString)(),o("design:type",String)],n.prototype,"nick_name",void 0),r([(0,s.IsEmail)(),o("design:type",String)],n.prototype,"email",void 0),r([(0,s.IsMobilePhone)("zh-CN"),o("design:type",String)],n.prototype,"phone",void 0),r([(0,s.IsString)(),o("design:type",String)],n.prototype,"password",void 0),r([(0,s.IsString)(),o("design:type",String)],n.prototype,"password_confirm",void 0),r([(0,s.IsString)(),o("design:type",String)],n.prototype,"type",void 0),r([(0,s.IsString)(),o("design:type",String)],n.prototype,"verify_code",void 0),r([(0,s.IsString)(),o("design:type",String)],n.prototype,"ip",void 0)},function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.PrismaModule=void 0;const o=i(3),s=i(17);let n=class{};t.PrismaModule=n,t.PrismaModule=n=r([(0,o.Module)({providers:[s.PrismaService],exports:[s.PrismaService]})],n)},function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.SmsModule=void 0;const o=i(3),s=i(61),n=i(8);let a=class{};t.SmsModule=a,t.SmsModule=a=r([(0,o.Module)({imports:[s.PrismaModule],controllers:[],providers:[n.SmsService],exports:[n.SmsService]})],a)},function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.AuthModule=void 0;const o=i(3),s=i(27),n=i(64),a=i(28),c=i(65),d=i(67),p=i(68),u=i(61);let l=class{};t.AuthModule=l,t.AuthModule=l=r([(0,o.Module)({imports:[u.PrismaModule,n.PassportModule,a.JwtModule.register({})],controllers:[p.AuthController],providers:[s.AuthService,c.JwtStrategy,d.RefreshTokenStrategy],exports:[s.AuthService]})],l)},e=>{e.exports=require("@nestjs/passport")},function(e,t,i){var r,o=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.JwtStrategy=void 0;const n=i(3),a=i(10),c=i(64),d=i(66);let p=class extends((0,c.PassportStrategy)(d.Strategy,"jwt")){constructor(e){super({jwtFromRequest:d.ExtractJwt.fromAuthHeaderAsBearerToken(),ignoreExpiration:!1,secretOrKey:e.get("JWT_ACCESS_SECRET")}),this.configService=e}async validate(e){return e}};t.JwtStrategy=p,t.JwtStrategy=p=o([(0,n.Injectable)(),s("design:paramtypes",["function"==typeof(r=void 0!==a.ConfigService&&a.ConfigService)?r:Object])],p)},e=>{e.exports=require("passport-jwt")},function(e,t,i){var r,o=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.RefreshTokenStrategy=void 0;const n=i(64),a=i(66),c=i(3),d=i(10);let p=class extends((0,n.PassportStrategy)(a.Strategy,"jwt-refresh")){constructor(e){super({jwtFromRequest:a.ExtractJwt.fromAuthHeaderAsBearerToken(),secretOrKey:e.get("JWT_REFRESH_SECRET"),passReqToCallback:!0}),this.configService=e}validate(e,t){return{...t,refreshToken:e.get("Authorization").replace("Bearer","").trim()}}};t.RefreshTokenStrategy=p,t.RefreshTokenStrategy=p=o([(0,c.Injectable)(),s("design:paramtypes",["function"==typeof(r=void 0!==d.ConfigService&&d.ConfigService)?r:Object])],p)},function(e,t,i){var r,o,s,n=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.AuthController=void 0;const d=i(3),p=i(27),u=i(59),l=i(69),f=i(56),v=i(19);let _=class{constructor(e,t){this.authService=e,this.toolsService=t}signin(e,t){const i={...e,ip:this.toolsService.getReqIP(t)};return(0,f.Send)(this.authService.signIn(i))}refreshToken(e){return(0,f.Send)(this.authService.refreshTokens(e?.refresh_token))}logout(e){return(0,f.Send)(this.authService.logout(e?.user?.sub))}};t.AuthController=_,n([(0,u.Public)(),(0,d.Post)("signin"),c(0,(0,d.Body)()),c(1,(0,d.Request)()),a("design:type",Function),a("design:paramtypes",["function"==typeof(s=void 0!==l.SignInDto&&l.SignInDto)?s:Object,Object]),a("design:returntype",void 0)],_.prototype,"signin",null),n([(0,u.Public)(),(0,d.Post)("refresh_token"),c(0,(0,d.Body)()),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",void 0)],_.prototype,"refreshToken",null),n([(0,d.Post)("logout"),c(0,(0,d.Req)()),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",void 0)],_.prototype,"logout",null),t.AuthController=_=n([(0,d.Controller)({version:"1.0",path:"auth"}),a("design:paramtypes",["function"==typeof(r=void 0!==p.AuthService&&p.AuthService)?r:Object,"function"==typeof(o=void 0!==v.ToolsService&&v.ToolsService)?o:Object])],_)},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.TeamModule=void 0;const o=i(3),s=i(71),n=i(54),a=i(61),c=i(72),d=i(84);let p=class{};t.TeamModule=p,t.TeamModule=p=r([(0,o.Module)({imports:[a.PrismaModule,(0,o.forwardRef)((()=>c.ProjectModule)),d.NotificationModule],controllers:[s.TeamController],providers:[n.TeamService],exports:[n.TeamService]})],p)},function(e,t,i){var r,o,s=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.TeamController=void 0;const c=i(3),d=i(54),p=i(56),u=i(29),l=i(7);let f=class{constructor(e,t){this.teamService=e,this.projectService=t}createTeam(e,t){const i=t?.user?.sub,r={...e,user_id:i};return(0,p.Send)(this.teamService.createTeam(r))}deleteTeam(e,t,i){const r=e?.user?.sub,o=i?.team_name;return(0,p.Send)(this.teamService.disbandTeam({user_id:r,team_id:t,team_name:o}))}getTeam(e){return(0,p.Send)(this.teamService.getTeamInfo(e))}updateTeam(e,t){const i=(0,l.pick)(t??{},["name","description"]);return(0,p.Send)(this.teamService.updateTeamInfo(e,i))}updateNickName(e,t,i){const r=t?.user?.sub,o=i?.nick_name,s={team_id:e,user_id:r,nick_name:o};return(0,p.Send)(this.teamService.updateNickName(s))}transfer(e,t,i){const r=e?.user?.sub,o={team_id:t,old_owner_id:r,new_owner_id:i.new_owner_id};return(0,p.Send)(this.teamService.transferTeam(o))}disband(e,t,i){const r=e?.user?.sub,o=i?.team_name;return(0,p.Send)(this.teamService.disbandTeam({user_id:r,team_id:t,team_name:o}))}getAllProjects(e){return(0,p.Send)(this.projectService.getProjectsByTeamId(e))}getUserProjects(e,t){const i=e?.user?.sub,r={user_id:i,team_id:t};return(0,p.Send)(this.projectService.getProjectsByUserIdAndTeamId(r))}getAllUsers(e,t){const i=e?.user?.sub,r={user_id:i,team_id:t};return(0,p.Send)(this.teamService.getAllUsers(r))}exitTeam(e,t){const i=e?.user?.sub,r={user_id:i,team_id:t};return(0,p.Send)(this.teamService.exitTeam(r))}removeUser(e,t,i){const r=e?.user?.sub,o={user_id:r,team_id:t,target_user_id:i};return(0,p.Send)(this.teamService.removeUser(o))}updateUserNickName(e,t,i,r){const o=i?.user?.sub,s=r?.nick_name,n={team_id:e,user_id:o,target_user_id:t,nick_name:s};return(0,p.Send)(this.teamService.updateUserNickName(n))}getUserRoles(e,t,i){const r=i?.user?.sub,o={team_id:e,user_id:r,target_user_id:t};return(0,p.Send)(this.teamService.getUserRoles(o))}updateUserRoles(e,t,i,r){const o=i?.user?.sub,s={user_id:o,team_id:e,target_user_id:t,team_role:r?.team_role,project_roles:r?.project_roles};return(0,p.Send)(this.teamService.updateUserRoles(s))}};t.TeamController=f,s([(0,c.Post)(),a(0,(0,c.Body)()),a(1,(0,c.Req)()),n("design:type",Function),n("design:paramtypes",[Object,Object]),n("design:returntype",void 0)],f.prototype,"createTeam",null),s([(0,c.Delete)("/:team_id"),a(0,(0,c.Req)()),a(1,(0,c.Param)("team_id")),a(2,(0,c.Query)()),n("design:type",Function),n("design:paramtypes",[Object,String,Object]),n("design:returntype",void 0)],f.prototype,"deleteTeam",null),s([(0,c.Get)("/:team_id"),a(0,(0,c.Param)("team_id")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",void 0)],f.prototype,"getTeam",null),s([(0,c.Patch)("/:team_id"),a(0,(0,c.Param)("team_id")),a(1,(0,c.Body)()),n("design:type",Function),n("design:paramtypes",[String,Object]),n("design:returntype",void 0)],f.prototype,"updateTeam",null),s([(0,c.Post)("/:team_id/nick-name"),a(0,(0,c.Param)("team_id")),a(1,(0,c.Req)()),a(2,(0,c.Body)()),n("design:type",Function),n("design:paramtypes",[String,Object,Object]),n("design:returntype",void 0)],f.prototype,"updateNickName",null),s([(0,c.Post)("/:team_id/transfer"),a(0,(0,c.Req)()),a(1,(0,c.Param)("team_id")),a(2,(0,c.Body)()),n("design:type",Function),n("design:paramtypes",[Object,String,Object]),n("design:returntype",void 0)],f.prototype,"transfer",null),s([(0,c.Post)("/:team_id/disband"),a(0,(0,c.Req)()),a(1,(0,c.Param)("team_id")),a(2,(0,c.Query)()),n("design:type",Function),n("design:paramtypes",[Object,String,Object]),n("design:returntype",void 0)],f.prototype,"disband",null),s([(0,c.Get)("/:team_id/all-projects"),a(0,(0,c.Param)("team_id")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",void 0)],f.prototype,"getAllProjects",null),s([(0,c.Get)("/:team_id/user-projects"),a(0,(0,c.Req)()),a(1,(0,c.Param)("team_id")),n("design:type",Function),n("design:paramtypes",[Object,String]),n("design:returntype",void 0)],f.prototype,"getUserProjects",null),s([(0,c.Get)("/:team_id/all-users"),a(0,(0,c.Req)()),a(1,(0,c.Param)("team_id")),n("design:type",Function),n("design:paramtypes",[Object,String]),n("design:returntype",void 0)],f.prototype,"getAllUsers",null),s([(0,c.Post)("/:team_id/exit-team"),a(0,(0,c.Req)()),a(1,(0,c.Param)("team_id")),n("design:type",Function),n("design:paramtypes",[Object,String]),n("design:returntype",void 0)],f.prototype,"exitTeam",null),s([(0,c.Delete)("/:team_id/remove-user/:target_user_id"),a(0,(0,c.Req)()),a(1,(0,c.Param)("team_id")),a(2,(0,c.Param)("target_user_id")),n("design:type",Function),n("design:paramtypes",[Object,String,String]),n("design:returntype",void 0)],f.prototype,"removeUser",null),s([(0,c.Post)("/:team_id/user-nick-name/:target_user_id"),a(0,(0,c.Param)("team_id")),a(1,(0,c.Param)("target_user_id")),a(2,(0,c.Req)()),a(3,(0,c.Body)()),n("design:type",Function),n("design:paramtypes",[String,String,Object,Object]),n("design:returntype",void 0)],f.prototype,"updateUserNickName",null),s([(0,c.Get)("/:team_id/user-roles/:target_user_id"),a(0,(0,c.Param)("team_id")),a(1,(0,c.Param)("target_user_id")),a(2,(0,c.Req)()),n("design:type",Function),n("design:paramtypes",[String,String,Object]),n("design:returntype",void 0)],f.prototype,"getUserRoles",null),s([(0,c.Post)("/:team_id/user-roles/:target_user_id"),a(0,(0,c.Param)("team_id")),a(1,(0,c.Param)("target_user_id")),a(2,(0,c.Req)()),a(3,(0,c.Body)()),n("design:type",Function),n("design:paramtypes",[String,String,Object,Object]),n("design:returntype",void 0)],f.prototype,"updateUserRoles",null),t.TeamController=f=s([(0,c.Controller)({version:"1.0",path:"teams"}),n("design:paramtypes",["function"==typeof(r=void 0!==d.TeamService&&d.TeamService)?r:Object,"function"==typeof(o=void 0!==u.ProjectService&&u.ProjectService)?o:Object])],f)},function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.ProjectModule=void 0;const o=i(3),s=i(73),n=i(29),a=i(61),c=i(74),d=i(76),p=i(78),u=i(80),l=i(82),f=i(4),v=i(84),_=i(86),h=i(89),y=i(92),m=i(95),S=i(98);let j=class{};t.ProjectModule=j,t.ProjectModule=j=r([(0,o.Module)({imports:[a.PrismaModule,(0,o.forwardRef)((()=>f.UserModule)),c.MocksModule,d.ApisConfigModule,p.ServersModule,u.EnvsModule,l.DocsModule,v.NotificationModule,_.ParamsModule,h.ScriptsModule,y.WebHookModule,m.SharesModule,(0,o.forwardRef)((()=>S.ApisModule))],controllers:[s.ProjectController],providers:[n.ProjectService],exports:[n.ProjectService]})],j)},function(e,t,i){var r,o=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ProjectController=void 0;const a=i(3),c=i(29),d=i(56),p=i(7);let u=class{constructor(e){this.projecctService=e}createBlankProject(e,t){const i={...e,user_id:t?.user?.sub};return(0,d.Send)(this.projecctService.createProject(i))}deleteTeam(e,t){const i={user_id:t?.user?.sub,project_id:e};return(0,d.Send)(this.projecctService.deleteProject(i))}getProjectDetail(e,t){const i={project_id:e,user_id:t?.user?.sub};return(0,d.Send)(this.projecctService.getProjectDetail(i))}updateProject(e,t,i){const r=(0,p.pick)(t??{},["name","description","logo"]);return(0,d.Send)(this.projecctService.updateProject({...r,user_id:i?.user?.sub,project_id:e}))}cloneProject(){return"克隆项目"}moveProject(e,t,i){const r=t?.new_team_id,o={user_id:i?.user?.sub,new_team_id:r,project_id:e};return(0,d.Send)(this.projecctService.moveProject(o))}exitProject(e,t){const i=t?.user?.sub,r={project_id:e,user_id:i};return(0,d.Send)(this.projecctService.exitProject(r))}getProjectUserList(e,t){const i=t?.user?.sub,r={project_id:e,user_id:i};return(0,d.Send)(this.projecctService.getProjectUserList(r))}};t.ProjectController=u,o([(0,a.Post)(),n(0,(0,a.Body)()),n(1,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",void 0)],u.prototype,"createBlankProject",null),o([(0,a.Delete)("/:project_id"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",void 0)],u.prototype,"deleteTeam",null),o([(0,a.Get)("/:project_id"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",void 0)],u.prototype,"getProjectDetail",null),o([(0,a.Patch)("/:project_id"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Body)()),n(2,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[String,Object,Object]),s("design:returntype",void 0)],u.prototype,"updateProject",null),o([(0,a.Post)("/:project_id/clone"),s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",void 0)],u.prototype,"cloneProject",null),o([(0,a.Post)("/:project_id/move"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Body)()),n(2,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[String,Object,Object]),s("design:returntype",void 0)],u.prototype,"moveProject",null),o([(0,a.Post)("/:project_id/exit"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",void 0)],u.prototype,"exitProject",null),o([(0,a.Get)("/:project_id/user-list"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",void 0)],u.prototype,"getProjectUserList",null),t.ProjectController=u=o([(0,a.Controller)({version:"1.0",path:"projects"}),s("design:paramtypes",["function"==typeof(r=void 0!==c.ProjectService&&c.ProjectService)?r:Object])],u)},function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.MocksModule=void 0;const o=i(3),s=i(61),n=i(75),a=i(36),c=i(4);let d=class{};t.MocksModule=d,t.MocksModule=d=r([(0,o.Module)({imports:[s.PrismaModule,(0,o.forwardRef)((()=>c.UserModule))],controllers:[n.MocksController],providers:[a.MocksService],exports:[a.MocksService]})],d)},function(e,t,i){var r,o=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.MocksController=void 0;const a=i(3),c=i(56),d=i(36);let p=class{constructor(e){this.mocksService=e}getMockDetail(e){return(0,c.Send)(this.mocksService.getMockDetail(e))}updateMock(e,t,i){const r=t?.user?.sub,o={...i,user_id:r,project_id:e};return(0,c.Send)(this.mocksService.updateMock(o))}};t.MocksController=p,o([(0,a.Get)(),n(0,(0,a.Param)("project_id")),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",void 0)],p.prototype,"getMockDetail",null),o([(0,a.Patch)(),n(0,(0,a.Param)("project_id")),n(1,(0,a.Req)()),n(2,(0,a.Body)()),s("design:type",Function),s("design:paramtypes",[String,Object,Object]),s("design:returntype",void 0)],p.prototype,"updateMock",null),t.MocksController=p=o([(0,a.Controller)({version:"1.0",path:"projects/:project_id/mocks"}),s("design:paramtypes",["function"==typeof(r=void 0!==d.MocksService&&d.MocksService)?r:Object])],p)},function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.ApisConfigModule=void 0;const o=i(3),s=i(61),n=i(77),a=i(30),c=i(4);let d=class{};t.ApisConfigModule=d,t.ApisConfigModule=d=r([(0,o.Module)({imports:[s.PrismaModule,(0,o.forwardRef)((()=>c.UserModule))],controllers:[n.ApisConfigController],providers:[a.ApisConfigService],exports:[a.ApisConfigService]})],d)},function(e,t,i){var r,o=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ApisConfigController=void 0;const a=i(3),c=i(56),d=i(30);let p=class{constructor(e){this.apisConfigService=e}getApisConfig(e){return(0,c.Send)(this.apisConfigService.getApiConfig(e))}updateApisConfig(e,t,i){const r=t?.user?.sub,o={...i,user_id:r,project_id:e};return(0,c.Send)(this.apisConfigService.updateApisConfig(o))}};t.ApisConfigController=p,o([(0,a.Get)(),n(0,(0,a.Param)("project_id")),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",void 0)],p.prototype,"getApisConfig",null),o([(0,a.Patch)(),n(0,(0,a.Param)("project_id")),n(1,(0,a.Req)()),n(2,(0,a.Body)()),s("design:type",Function),s("design:paramtypes",[String,Object,Object]),s("design:returntype",void 0)],p.prototype,"updateApisConfig",null),t.ApisConfigController=p=o([(0,a.Controller)({version:"1.0",path:"projects/:project_id/apis-config"}),s("design:paramtypes",["function"==typeof(r=void 0!==d.ApisConfigService&&d.ApisConfigService)?r:Object])],p)},function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.ServersModule=void 0;const o=i(3),s=i(79),n=i(38),a=i(61),c=i(4);let d=class{};t.ServersModule=d,t.ServersModule=d=r([(0,o.Module)({imports:[a.PrismaModule,(0,o.forwardRef)((()=>c.UserModule))],controllers:[s.ServersController],providers:[n.ServersService],exports:[n.ServersService]})],d)},function(e,t,i){var r,o=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ServersController=void 0;const a=i(3),c=i(56),d=i(38);let p=class{constructor(e){this.serverService=e}getServers(e){return(0,c.Send)(this.serverService.getServers(e))}saveServer(e,t,i){const r={...t,user_id:i?.user?.sub,project_id:e};return(0,c.Send)(this.serverService.saveServer(r))}deleteServer(e,t,i){const r={user_id:i?.user?.sub,project_id:e,server_id:t};return(0,c.Send)(this.serverService.deleteServer(r))}updateServer(e,t,i,r){const o={...i,user_id:r?.user?.sub,project_id:e,server_id:t};return(0,c.Send)(this.serverService.updateServer(o))}};t.ServersController=p,o([(0,a.Get)(),n(0,(0,a.Param)("project_id")),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",void 0)],p.prototype,"getServers",null),o([(0,a.Put)(),n(0,(0,a.Param)("project_id")),n(1,(0,a.Body)()),n(2,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"saveServer",null),o([(0,a.Delete)("/:server_id"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Param)("server_id")),n(2,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object,String,Object]),s("design:returntype",void 0)],p.prototype,"deleteServer",null),o([(0,a.Patch)("/:server_id"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Param)("server_id")),n(2,(0,a.Body)()),n(3,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object,String,Object,Object]),s("design:returntype",void 0)],p.prototype,"updateServer",null),t.ServersController=p=o([(0,a.Controller)({version:"1.0",path:"projects/:project_id/servers"}),s("design:paramtypes",["function"==typeof(r=void 0!==d.ServersService&&d.ServersService)?r:Object])],p)},function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.EnvsModule=void 0;const o=i(3),s=i(61),n=i(34),a=i(81),c=i(4);let d=class{};t.EnvsModule=d,t.EnvsModule=d=r([(0,o.Module)({imports:[s.PrismaModule,(0,o.forwardRef)((()=>c.UserModule))],controllers:[a.EnvsController],providers:[n.EnvsService],exports:[n.EnvsService]})],d)},function(e,t,i){var r,o=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.EnvsController=void 0;const a=i(3),c=i(56),d=i(34);let p=class{constructor(e){this.envsService=e}getEnvList(e,t){const i=t?.user?.sub,r={user_id:i,project_id:e};return(0,c.Send)(this.envsService.getEnviroments(r))}createEnv(e,t,i){const r=i?.user?.sub,o={...t,user_id:r,project_id:e};return(0,c.Send)(this.envsService.createEnviroment(o))}deleteEnv(e,t,i){const r=i?.user?.sub,o={user_id:r,project_id:e,env_id:t};return(0,c.Send)(this.envsService.deleteEnviroment(o))}getEnvDetail(e,t,i){const r=i?.user?.sub,o={user_id:r,project_id:e,env_id:t};return(0,c.Send)(this.envsService.getEnviroment(o))}updateEnv(e,t,i,r){const o=r?.user?.sub,s={...i,user_id:o,project_id:e,env_id:t};return(0,c.Send)(this.envsService.updateEnviroment(s))}};t.EnvsController=p,o([(0,a.Get)(),n(0,(0,a.Param)("project_id")),n(1,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",void 0)],p.prototype,"getEnvList",null),o([(0,a.Put)(),n(0,(0,a.Param)("project_id")),n(1,(0,a.Body)()),n(2,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"createEnv",null),o([(0,a.Delete)("/:env_id"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Param)("env_id")),n(2,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"deleteEnv",null),o([(0,a.Get)("/:env_id"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Param)("env_id")),n(2,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"getEnvDetail",null),o([(0,a.Patch)("/:env_id"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Param)("env_id")),n(2,(0,a.Body)()),n(3,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"updateEnv",null),t.EnvsController=p=o([(0,a.Controller)({version:"1.0",path:"/projects/:project_id/envs"}),s("design:paramtypes",["function"==typeof(r=void 0!==d.EnvsService&&d.EnvsService)?r:Object])],p)},function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.DocsModule=void 0;const o=i(3),s=i(83),n=i(32),a=i(61),c=i(4);let d=class{};t.DocsModule=d,t.DocsModule=d=r([(0,o.Module)({imports:[a.PrismaModule,(0,o.forwardRef)((()=>c.UserModule))],controllers:[s.DocsController],providers:[n.DocsService],exports:[n.DocsService]})],d)},function(e,t,i){var r,o=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DocsController=void 0;const a=i(3),c=i(56),d=i(32);let p=class{constructor(e){this.docsService=e}getDocumentConfig(e,t){const i={user_id:t?.user?.sub,project_id:e};return(0,c.Send)(this.docsService.getDocumentConfig(i))}updateDocState(e,t,i){const r=i?.user?.sub,o={user_id:r,project_id:e,state:t.state};return(0,c.Send)(this.docsService.updateState(o))}updatePublishConfig(e,t,i){const r=i?.user?.sub,o={user_id:r,project_id:e,publish_config:t};return(0,c.Send)(this.docsService.updatePublishConfig(o))}updateBaseConfig(e,t,i){const r=i?.user?.sub,o={user_id:r,project_id:e,base_config:t};return(0,c.Send)(this.docsService.updateBaseConfig(o))}};t.DocsController=p,o([(0,a.Get)(),n(0,(0,a.Param)("project_id")),n(1,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",void 0)],p.prototype,"getDocumentConfig",null),o([(0,a.Post)("/set-state"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Body)()),n(2,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"updateDocState",null),o([(0,a.Post)("/publish-config"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Body)()),n(2,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"updatePublishConfig",null),o([(0,a.Post)("/base-config"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Body)()),n(2,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"updateBaseConfig",null),t.DocsController=p=o([(0,a.Controller)({version:"1.0",path:"/projects/:project_id/docs"}),s("design:paramtypes",["function"==typeof(r=void 0!==d.DocsService&&d.DocsService)?r:Object])],p)},function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.NotificationModule=void 0;const o=i(3),s=i(61),n=i(85),a=i(40),c=i(28);let d=class{};t.NotificationModule=d,t.NotificationModule=d=r([(0,o.Module)({imports:[s.PrismaModule,c.JwtModule.register({})],controllers:[n.NotificationController],providers:[a.NotificationService],exports:[a.NotificationService]})],d)},function(e,t,i){var r,o=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.NotificationController=void 0;const a=i(3),c=i(56),d=i(40),p=i(59);let u=class{constructor(e){this.notificationService=e}getNotifyList(e){const t=e?.split(" ")?.[1];return(0,c.Send)(this.notificationService.getNotifyList(t))}clearNotification(e){const t=e.user.sub;return(0,c.Send)(this.notificationService.clearNotification(t))}};t.NotificationController=u,o([(0,p.Public)(),(0,a.Get)(),n(0,(0,a.Headers)("authorization")),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",void 0)],u.prototype,"getNotifyList",null),o([(0,a.Post)("/clear"),n(0,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",void 0)],u.prototype,"clearNotification",null),t.NotificationController=u=o([(0,a.Controller)({version:"1.0",path:"notifications"}),s("design:paramtypes",["function"==typeof(r=void 0!==d.NotificationService&&d.NotificationService)?r:Object])],u)},function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.ParamsModule=void 0;const o=i(3),s=i(87),n=i(88),a=i(61),c=i(4);let d=class{};t.ParamsModule=d,t.ParamsModule=d=r([(0,o.Module)({imports:[a.PrismaModule,(0,o.forwardRef)((()=>c.UserModule))],controllers:[n.ParamsController],providers:[s.ParamsService],exports:[s.ParamsService]})],d)},function(e,t,i){var r,o,s=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ParamsService=void 0;const c=i(3),d=i(7),p=i(17),u=i(6),l=i(14),f=i(25);let v=class{constructor(e,t){this.prismaService=e,this.userService=t}async importParams(e){if(6!==await this.userService.getUserProjectRole(e))throw new c.HttpException("未授权",c.HttpStatus.OK);const t=[];e.list.forEach((i=>{(0,d.isEmpty)(i?.name)||(0,d.isEmpty)(i?.description)||t.push({id:(0,l.v4)(),project_id:e.project_id,name:i.name,description:i.description,type:2,create_time:(0,f.default)().format()})}));return await this.prismaService.projectParams.createMany({data:t})}async deleteParams(e){if(6!==await this.userService.getUserProjectRole(e))throw new c.HttpException("未授权",c.HttpStatus.OK);return await this.prismaService.projectParams.delete({where:{id:e.id}}),!0}async getStoredParams(e){const t=await this.userService.getUserProjectRole(e);if(![4,6].includes(t))throw new c.HttpException("未授权",c.HttpStatus.OK);return await this.prismaService.projectParams.findMany({where:{project_id:e.project_id}})}async updateParams(e){const t=await this.userService.getUserProjectRole(e);if(![2,6].includes(t))throw new c.HttpException("未授权",c.HttpStatus.OK);const i=(0,d.pick)(e,["name","description"]);return await this.prismaService.projectParams.update({where:{id:e.id},data:i})}};t.ParamsService=v,t.ParamsService=v=s([(0,c.Injectable)(),a(1,(0,c.Inject)((0,c.forwardRef)((()=>u.UserService)))),n("design:paramtypes",["function"==typeof(r=void 0!==p.PrismaService&&p.PrismaService)?r:Object,"function"==typeof(o=void 0!==u.UserService&&u.UserService)?o:Object])],v)},function(e,t,i){var r,o=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ParamsController=void 0;const a=i(3),c=i(56),d=i(87);let p=class{constructor(e){this.paramsService=e}importParams(e,t,i){const r={project_id:e,user_id:t?.user?.sub,list:i};return(0,c.Send)(this.paramsService.importParams(r))}deleteParams(e,t,i){const r={project_id:e,user_id:i?.user?.sub,id:t};return(0,c.Send)(this.paramsService.deleteParams(r))}getStoredParams(e,t){const i={project_id:e,user_id:t?.user?.sub};return(0,c.Send)(this.paramsService.getStoredParams(i))}updateParams(e,t,i,r){const o={...r,project_id:e,user_id:i?.user?.sub,id:t};return(0,c.Send)(this.paramsService.updateParams(o))}};t.ParamsController=p,o([(0,a.Post)(),n(0,(0,a.Param)("project_id")),n(1,(0,a.Req)()),n(2,(0,a.Body)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"importParams",null),o([(0,a.Delete)("/:id"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Param)("id")),n(2,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"deleteParams",null),o([(0,a.Get)("/stored-params"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",void 0)],p.prototype,"getStoredParams",null),o([(0,a.Patch)("/:id"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Param)("id")),n(2,(0,a.Req)()),n(3,(0,a.Body)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"updateParams",null),t.ParamsController=p=o([(0,a.Controller)({version:"1.0",path:"projects/:project_id/params"}),s("design:paramtypes",["function"==typeof(r=void 0!==d.ParamsService&&d.ParamsService)?r:Object])],p)},function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.ScriptsModule=void 0;const o=i(3),s=i(61),n=i(90),a=i(91),c=i(4);let d=class{};t.ScriptsModule=d,t.ScriptsModule=d=r([(0,o.Module)({imports:[s.PrismaModule,(0,o.forwardRef)((()=>c.UserModule))],controllers:[n.ScriptsController],providers:[a.ScriptsService],exports:[a.ScriptsService]})],d)},function(e,t,i){var r,o=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ScriptsController=void 0;const a=i(3),c=i(56),d=i(91);let p=class{constructor(e){this.scriptsService=e}getScriptList(e,t){const i={project_id:e,user_id:t?.user?.sub};return(0,c.Send)(this.scriptsService.getScriptList(i))}createScript(e,t,i){const r={...i,project_id:e,user_id:t?.user?.sub};return(0,c.Send)(this.scriptsService.addScript(r))}deleteScript(e,t,i){const r={project_id:e,user_id:i?.user?.sub,id:t};return(0,c.Send)(this.scriptsService.deleteScript(r))}getDetail(e,t,i){const r={project_id:e,user_id:i?.user?.sub,id:t};return(0,c.Send)(this.scriptsService.getScriptInfo(r))}updateScript(e,t,i,r){const o={...r,project_id:e,id:t,user_id:i?.user?.sub};return(0,c.Send)(this.scriptsService.updateScript(o))}};t.ScriptsController=p,o([(0,a.Get)(),n(0,(0,a.Param)("project_id")),n(1,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",void 0)],p.prototype,"getScriptList",null),o([(0,a.Post)(),n(0,(0,a.Param)("project_id")),n(1,(0,a.Req)()),n(2,(0,a.Body)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"createScript",null),o([(0,a.Delete)("/:id"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Param)("id")),n(2,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"deleteScript",null),o([(0,a.Get)("/:id"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Param)("id")),n(2,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"getDetail",null),o([(0,a.Patch)("/:id"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Param)("id")),n(2,(0,a.Req)()),n(3,(0,a.Body)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"updateScript",null),t.ScriptsController=p=o([(0,a.Controller)({version:"1.0",path:"projects/:project_id/scripts"}),s("design:paramtypes",["function"==typeof(r=void 0!==d.ScriptsService&&d.ScriptsService)?r:Object])],p)},function(e,t,i){var r,o,s=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ScriptsService=void 0;const a=i(3),c=i(17),d=i(6),p=i(25);let u=class{constructor(e,t){this.prismaService=e,this.userService=t}async addScript(e){const t=await this.userService.getUserProjectRole(e);if(![2,6].includes(t))throw new a.HttpException("未授权",a.HttpStatus.OK);const i={id:e.id,project_id:e.project_id,name:e.name,description:e.description,data:e.data,create_time:(0,p.default)().format()};return await this.prismaService.projectCommonScripts.create({data:i})}async getScriptList(e){const t=await this.userService.getUserProjectRole(e);if(![4,6].includes(t))throw new a.HttpException("未授权",a.HttpStatus.OK);return await this.prismaService.projectCommonScripts.findMany({where:{project_id:e.project_id}})}async deleteScript(e){const t=await this.userService.getUserProjectRole(e);if(![2,6].includes(t))throw new a.HttpException("未授权",a.HttpStatus.OK);return await this.prismaService.projectCommonScripts.delete({where:{id:e.id}}),!0}async getScriptInfo(e){const t=await this.userService.getUserProjectRole(e);if(![4,6].includes(t))throw new a.HttpException("未授权",a.HttpStatus.OK);return await this.prismaService.projectCommonScripts.findUnique({where:{id:e.id}})}async updateScript(e){const t=await this.userService.getUserProjectRole(e);if(![2,6].includes(t))throw new a.HttpException("未授权",a.HttpStatus.OK);const i={name:e.name,description:e.description,data:e.data};return await this.prismaService.projectCommonScripts.update({where:{id:e.id},data:i})}};t.ScriptsService=u,t.ScriptsService=u=s([(0,a.Injectable)(),n("design:paramtypes",["function"==typeof(r=void 0!==c.PrismaService&&c.PrismaService)?r:Object,"function"==typeof(o=void 0!==d.UserService&&d.UserService)?o:Object])],u)},function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.WebHookModule=void 0;const o=i(3),s=i(93),n=i(94),a=i(61),c=i(4);let d=class{};t.WebHookModule=d,t.WebHookModule=d=r([(0,o.Module)({imports:[a.PrismaModule,(0,o.forwardRef)((()=>c.UserModule))],controllers:[s.WebHookController],providers:[n.WebHookService],exports:[n.WebHookService]})],d)},function(e,t,i){var r,o=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.WebHookController=void 0;const a=i(3),c=i(94),d=i(56);let p=class{constructor(e){this.webhookService=e}getWebhooksList(e,t){const i={project_id:e,user_id:t?.user?.sub};return(0,d.Send)(this.webhookService.getWebhooksList(i))}createWebHook(e,t,i){const r={...i,project_id:e,user_id:t?.user?.sub};return(0,d.Send)(this.webhookService.createWebHook(r))}deleteWebHook(e,t,i){const r={project_id:e,user_id:i?.user?.sub,id:t};return(0,d.Send)(this.webhookService.deleteWebhook(r))}getDetail(e,t,i){const r={project_id:e,user_id:i?.user?.sub,id:t};return(0,d.Send)(this.webhookService.getWebhookDetail(r))}updateWebHook(e,t,i,r){const o={...r,project_id:e,user_id:i?.user?.sub,id:t};return(0,d.Send)(this.webhookService.updateWebhook(o))}};t.WebHookController=p,o([(0,a.Get)(),n(0,(0,a.Param)("project_id")),n(1,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",void 0)],p.prototype,"getWebhooksList",null),o([(0,a.Post)(),n(0,(0,a.Param)("project_id")),n(1,(0,a.Req)()),n(2,(0,a.Body)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"createWebHook",null),o([(0,a.Delete)("/:id"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Param)("id")),n(2,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"deleteWebHook",null),o([(0,a.Get)("/:id"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Param)("id")),n(2,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"getDetail",null),o([(0,a.Patch)("/:id"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Param)("id")),n(2,(0,a.Req)()),n(3,(0,a.Body)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"updateWebHook",null),t.WebHookController=p=o([(0,a.Controller)({version:"1.0",path:"projects/:project_id/webhooks"}),s("design:paramtypes",["function"==typeof(r=void 0!==c.WebHookService&&c.WebHookService)?r:Object])],p)},function(e,t,i){var r,o,s=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.WebHookService=void 0;const c=i(3),d=i(17),p=i(7),u=i(6),l=i(25);let f=class{constructor(e,t){this.prismaService=e,this.userService=t}async createWebHook(e){const t=await this.userService.getUserProjectRole(e);if(![2,6].includes(t))throw new c.HttpException("未授权",c.HttpStatus.OK);const i=(0,p.pick)(e,["id","project_id","name","channel","config","triggers"]);return await this.prismaService.projectWebhooks.create({data:{...i,create_time:(0,l.default)().format(),is_used:1}})}async getWebhooksList(e){const t=await this.userService.getUserProjectRole(e);if(![4,6].includes(t))throw new c.HttpException("未授权",c.HttpStatus.OK);return await this.prismaService.projectWebhooks.findMany({where:{project_id:e.project_id}})}async getWebhookDetail(e){const t=await this.userService.getUserProjectRole(e);if(![4,6].includes(t))throw new c.HttpException("未授权",c.HttpStatus.OK);return await this.prismaService.projectWebhooks.findUnique({where:{id:e.id}})}async deleteWebhook(e){const t=await this.userService.getUserProjectRole(e);if(![2,6].includes(t))throw new c.HttpException("未授权",c.HttpStatus.OK);await this.prismaService.projectWebhooks.delete({where:{id:e.id}});return!0}async updateWebhook(e){const t=await this.userService.getUserProjectRole(e);if(![2,6].includes(t))throw new c.HttpException("未授权",c.HttpStatus.OK);const i=(0,p.pick)(e,["name","is_used","channel","config","triggers"]);return await this.prismaService.projectWebhooks.update({where:{id:e.id},data:i})}};t.WebHookService=f,t.WebHookService=f=s([(0,c.Injectable)(),a(1,(0,c.Inject)((0,c.forwardRef)((()=>u.UserService)))),n("design:paramtypes",["function"==typeof(r=void 0!==d.PrismaService&&d.PrismaService)?r:Object,"function"==typeof(o=void 0!==u.UserService&&u.UserService)?o:Object])],f)},function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.SharesModule=void 0;const o=i(3),s=i(96),n=i(97),a=i(61),c=i(4);let d=class{};t.SharesModule=d,t.SharesModule=d=r([(0,o.Module)({imports:[a.PrismaModule,(0,o.forwardRef)((()=>c.UserModule))],controllers:[n.SharesController],providers:[s.SharesService],exports:[s.SharesService]})],d)},function(e,t,i){var r,o,s,n=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.SharesService=void 0;const d=i(3),p=i(7),u=i(19),l=i(25),f=i(17),v=i(6);let _=class{constructor(e,t,i){this.prismaService=e,this.toolsService=t,this.userService=i}async createShare(e){const t=await this.userService.getUserProjectRole(e);if(![2,6].includes(t))throw new d.HttpException("未授权",d.HttpStatus.OK);const i=(0,p.pick)(e,["id","project_id","name","auth_type","expire_time","config"]);return await this.prismaService.sharedDocuments.create({data:{db_id:this.toolsService.getUniqueID(),...i,create_time:(0,l.default)().format()}})}async getShareList(e){const t=await this.userService.getUserProjectRole(e);if(![4,6].includes(t))throw new d.HttpException("未授权",d.HttpStatus.OK);const i=await this.prismaService.sharedDocuments.findMany({where:{project_id:e.project_id}});if(!(0,p.isArray)(i))return;return i.map((e=>({...e,is_expired:(0,p.isNull)(e.expire_time)?-1:(0,l.default)().unix()>(0,l.default)(e.expire_time).unix()?1:-1})))}async deleteShare(e){const t=await this.userService.getUserProjectRole(e);if(![2,6].includes(t))throw new d.HttpException("未授权",d.HttpStatus.OK);return await this.prismaService.sharedDocuments.delete({where:{id:e.id}})}async getShareDetail(e){const t=await this.userService.getUserProjectRole(e);if(![4,6].includes(t))throw new d.HttpException("未授权",d.HttpStatus.OK);return{detail:await this.prismaService.sharedDocuments.findUnique({select:{id:!0,name:!0,project_id:!0,auth_type:!0,expire_time:!0,create_time:!0,config:!0},where:{id:e.id}}),current_time:(0,l.default)().format()}}async updateShare(e){const t=await this.userService.getUserProjectRole(e);if(![2,6].includes(t))throw new d.HttpException("未授权",d.HttpStatus.OK);const i=(0,p.pick)(e,["name","auth_type","config","expire_time"]);return await this.prismaService.sharedDocuments.update({where:{id:e.id,project_id:e.project_id},data:i})}};t.SharesService=_,t.SharesService=_=n([(0,d.Injectable)(),c(2,(0,d.Inject)((0,d.forwardRef)((()=>v.UserService)))),a("design:paramtypes",["function"==typeof(r=void 0!==f.PrismaService&&f.PrismaService)?r:Object,"function"==typeof(o=void 0!==u.ToolsService&&u.ToolsService)?o:Object,"function"==typeof(s=void 0!==v.UserService&&v.UserService)?s:Object])],_)},function(e,t,i){var r,o=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.SharesController=void 0;const a=i(3),c=i(56),d=i(96);let p=class{constructor(e){this.sharesService=e}getShares(e,t){const i={project_id:e,user_id:t.user.sub};return(0,c.Send)(this.sharesService.getShareList(i))}createEnv(e,t,i){const r={...i,project_id:e,user_id:t.user.sub};return(0,c.Send)(this.sharesService.createShare(r))}deleteEnv(e,t,i){const r={project_id:e,user_id:t.user.sub,id:i};return(0,c.Send)(this.sharesService.deleteShare(r))}getShareDetail(e,t,i){const r={project_id:e,user_id:t.user.sub,id:i};return(0,c.Send)(this.sharesService.getShareDetail(r))}updateEnv(e,t,i,r){const o={...r,project_id:e,user_id:t.user.sub,id:i};return(0,c.Send)(this.sharesService.updateShare(o))}};t.SharesController=p,o([(0,a.Get)(),n(0,(0,a.Param)("project_id")),n(1,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",void 0)],p.prototype,"getShares",null),o([(0,a.Post)(),n(0,(0,a.Param)("project_id")),n(1,(0,a.Req)()),n(2,(0,a.Body)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"createEnv",null),o([(0,a.Delete)("/:id"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Req)()),n(2,(0,a.Param)("id")),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"deleteEnv",null),o([(0,a.Get)("/:id"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Req)()),n(2,(0,a.Param)("id")),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"getShareDetail",null),o([(0,a.Patch)("/:id"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Req)()),n(2,(0,a.Param)("id")),n(3,(0,a.Body)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"updateEnv",null),t.SharesController=p=o([(0,a.Controller)({version:"1.0",path:"projects/:project_id/shares"}),s("design:paramtypes",["function"==typeof(r=void 0!==d.SharesService&&d.SharesService)?r:Object])],p)},function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.ApisModule=void 0;const o=i(3),s=i(61),n=i(99),a=i(49),c=i(4),d=i(100);let p=class{};t.ApisModule=p,t.ApisModule=p=r([(0,o.Module)({imports:[d.FileStoreModule,s.PrismaModule,(0,o.forwardRef)((()=>c.UserModule))],controllers:[n.ApisController],providers:[a.ApisService],exports:[a.ApisService]})],p)},function(e,t,i){var r,o=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ApisController=void 0;const a=i(3),c=i(56),d=i(49);let p=class{constructor(e){this.apisService=e}saveApi(e,t,i){const r={...i,project_id:e,user_id:t?.user?.sub};return(0,c.Send)(this.apisService.saveApi(r))}getDetail(e,t,i){const r={project_id:e,user_id:i?.user?.sub,id:t};return(0,c.Send)(this.apisService.getApiDetail(r))}batchGetApiDetail(e,t,i){const r={project_id:e,user_id:t?.user?.sub,...i};return(0,c.Send)(this.apisService.batchGetApiDetail(r))}getApiDescribes(e,t){const i={project_id:e,user_id:t?.user?.sub};return(0,c.Send)(this.apisService.getApiDescribes(i))}deleteApi(e,t,i){const r={project_id:e,user_id:i?.user?.sub,id:t};return(0,c.Send)(this.apisService.deleteApi(r))}batchDeleteApi(e,t,i){const r={...i,project_id:e,user_id:t?.user?.sub};return(0,c.Send)(this.apisService.batchDeleteApi(r))}sortApiList(e,t,i){const r={...i,project_id:e,user_id:t?.user?.sub};return(0,c.Send)(this.apisService.sortApiList(r))}saveMultiApis(e,t,i){const r={project_id:e,user_id:t?.user?.sub,api_list:i};return(0,c.Send)(this.apisService.batchSaveApi(r))}lockApi(e,t,i){const r={project_id:e,user_id:i?.user?.sub,id:t};return(0,c.Send)(this.apisService.lockApi(r))}unLockApi(e,t,i){const r={project_id:e,user_id:i?.user?.sub,id:t};return(0,c.Send)(this.apisService.unLockApi(r))}};t.ApisController=p,o([(0,a.Put)("/save"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Req)()),n(2,(0,a.Body)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"saveApi",null),o([(0,a.Get)("/:api_id"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Param)("api_id")),n(2,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"getDetail",null),o([(0,a.Post)("/batch-details"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Req)()),n(2,(0,a.Body)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"batchGetApiDetail",null),o([(0,a.Get)(),n(0,(0,a.Param)("project_id")),n(1,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",void 0)],p.prototype,"getApiDescribes",null),o([(0,a.Delete)("/:api_id"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Param)("api_id")),n(2,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"deleteApi",null),o([(0,a.Post)("/batch-delete"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Req)()),n(2,(0,a.Body)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"batchDeleteApi",null),o([(0,a.Post)("/sort-list"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Req)()),n(2,(0,a.Body)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"sortApiList",null),o([(0,a.Post)("/batch-save"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Req)()),n(2,(0,a.Body)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"saveMultiApis",null),o([(0,a.Post)("/:api_id/lock"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Param)("api_id")),n(2,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"lockApi",null),o([(0,a.Post)("/:api_id/un-lock"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Param)("api_id")),n(2,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"unLockApi",null),t.ApisController=p=o([(0,a.Controller)({version:"1.0",path:"projects/:project_id/apis"}),s("design:paramtypes",["function"==typeof(r=void 0!==d.ApisService&&d.ApisService)?r:Object])],p)},function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.FileStoreModule=void 0;const o=i(3),s=i(50);let n=class{};t.FileStoreModule=n,t.FileStoreModule=n=r([(0,o.Module)({providers:[s.FileStoreService],exports:[s.FileStoreService]})],n)},function(e,t,i){var r,o=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.JwtAuthGuard=void 0;const n=i(3),a=i(1),c=i(64),d=i(59),p=i(26);let u=class extends((0,c.AuthGuard)("jwt")){constructor(e){super(),this.reflector=e}canActivate(e){return!!this.reflector.getAllAndOverride(d.PUBLICKEY,[e.getHandler(),e.getClass()])||super.canActivate(e)}handleRequest(e,t){if(p().unix()>p("2025-12-1").unix())throw e||new n.UnauthorizedException("当前版本过于落后，请进行升级");if(e||!t)throw e||new n.UnauthorizedException("Not Access");return t}};t.JwtAuthGuard=u,t.JwtAuthGuard=u=o([(0,n.Injectable)(),s("design:paramtypes",["function"==typeof(r=void 0!==a.Reflector&&a.Reflector)?r:Object])],u)},function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.DocsModule=void 0;const o=i(3),s=i(61),n=i(103),a=i(104),c=i(100);let d=class{};t.DocsModule=d,t.DocsModule=d=r([(0,o.Module)({imports:[s.PrismaModule,c.FileStoreModule],controllers:[n.DocsController],providers:[a.DocsService],exports:[]})],d)},function(e,t,i){var r,o=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DocsController=void 0;const a=i(3),c=i(56),d=i(104),p=i(59);let u=class{constructor(e){this.docsService=e}getApiShareBaseDetail(e){return(0,c.Send)(this.docsService.getApiShareBaseDetail(e))}getApiShareList(e,t){return(0,c.Send)(this.docsService.getApiShareList(e,t))}getApiDetail(e,t){return(0,c.Send)(this.docsService.getApiDetail(e,t))}validatePassword(e){const{share_id:t,password:i}=e;return(0,c.Send)(this.docsService.validatePassword(t,i))}};t.DocsController=u,o([(0,p.Public)(),(0,a.Get)("/api/base/:share_id"),n(0,(0,a.Param)("share_id")),s("design:type",Function),s("design:paramtypes",[String]),s("design:returntype",void 0)],u.prototype,"getApiShareBaseDetail",null),o([(0,p.Public)(),(0,a.Post)("/api/menulist/:project_id"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Body)()),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",void 0)],u.prototype,"getApiShareList",null),o([(0,p.Public)(),(0,a.Get)("/api/detail/:project_id/:api_id"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Param)("api_id")),s("design:type",Function),s("design:paramtypes",[String,String]),s("design:returntype",void 0)],u.prototype,"getApiDetail",null),o([(0,p.Public)(),(0,a.Post)("/api/validate-password"),n(0,(0,a.Body)()),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",void 0)],u.prototype,"validatePassword",null),t.DocsController=u=o([(0,a.Controller)({version:"1.0",path:"docs"}),s("design:paramtypes",["function"==typeof(r=void 0!==d.DocsService&&d.DocsService)?r:Object])],u)},function(e,t,i){var r,o,s,n=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.DocsService=void 0;const c=i(3),d=i(17),p=i(50),u=i(9),l=i(26),f=i(7),v=i(105);let _=class{constructor(e,t,i){this.prismaService=e,this.redisService=t,this.fileStoreService=i}async getProjectBucketName(e){const t=`PROJECT_BUCKET${e}`,i=await this.redisService.get(t);if((0,f.isString)(i))return i;const r=await this.prismaService.projects.findUnique({where:{project_id:e},select:{bucket_id:!0}});return await this.redisService.set(t,r.bucket_id),r.bucket_id}async getApiShareBaseDetail(e){const t=await this.prismaService.sharedDocuments.findUnique({select:{id:!0,name:!0,project_id:!0,auth_type:!0,expire_time:!0,create_time:!0,config:!0},where:{id:e}});if(!(0,f.isPlainObject)(t))throw new c.HttpException("分享数据不存在",c.HttpStatus.OK);if(!(0,f.isNull)(t.expire_time)&&l(t?.expire_time).unix()<l().unix())throw new c.HttpException("分享已过期",c.HttpStatus.OK);return{detail:t,project:await this.prismaService.projects.findUnique({where:{project_id:t?.project_id}})}}async getProjectShareList(e){return await this.prismaService.apiBase.findMany({where:{project_id:e,status:1},select:{id:!0,parent_id:!0,name:!0,method:!0,url:!0,data_type:!0,sort:!0}})}async getApiShareList(e,t){if("ALL"===t?.share_type)return await this.getProjectShareList(e);const i=await this.prismaService.apiBase.findMany({where:{project_id:e,status:1},select:{id:!0,parent_id:!0}}),r=(0,v.list2Tree)(i),o={},s=e=>{const t=r?.[e];t?.children?.forEach((e=>{o[e.id]=!0,(0,f.isArray)(e?.children)&&s(e?.id)}))},n=e=>{const t=r?.[e];(0,f.isUndefined)(t)||(o[e]=!0,"0"!==t?.parent_id&&n(t?.parent_id))},a=t?.share_ids;(0,f.isArray)(a)&&a?.forEach((e=>{o[e.id]=!0,"0"!==r[e?.id]?.parent_id&&n(r[e?.id]?.parent_id),1===e.is_all&&s(e.id)}));return await this.prismaService.apiBase.findMany({where:{project_id:e,status:1,id:{in:Object.keys(o)}},select:{id:!0,parent_id:!0,name:!0,method:!0,url:!0,data_type:!0,sort:!0}})}async getApiDetail(e,t){const i=await this.prismaService.apiBase.findUnique({where:{id:t}});if((0,f.isNull)(i)||[-1,-99].includes(i?.status))throw new c.HttpException("数据不存在或已被删除",c.HttpStatus.OK);const r=await this.getProjectBucketName(e),o=await this.fileStoreService.getData(r,t),s={};o.examples?.forEach((e=>{e?.schema?.x_hapydev_definitions?.forEach((e=>{s[e]=!0}))}));const n={};for await(const e of Object.keys(s)){const t=await this.fileStoreService.getData(r,e);n[e]=t}return{...i,models:n,data:o}}async validatePassword(e,t){const i=await this.prismaService.sharedDocuments.findUnique({select:{id:!0,auth_type:!0,expire_time:!0,create_time:!0,config:!0},where:{id:e}});return 1===i?.auth_type||i?.config?.password===t}};t.DocsService=_,t.DocsService=_=n([(0,c.Injectable)(),a("design:paramtypes",["function"==typeof(r=void 0!==d.PrismaService&&d.PrismaService)?r:Object,"function"==typeof(o=void 0!==u.RedisService&&u.RedisService)?o:Object,"function"==typeof(s=void 0!==p.FileStoreService&&p.FileStoreService)?s:Object])],_)},(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getModelDefinitionKeys=t.list2Tree=void 0;const r=i(7);t.list2Tree=e=>{const t=(0,r.cloneDeep)(e),i={};return t?.forEach((e=>{i[e.id]=e})),t?.forEach((e=>{const t=i?.[e?.parent_id];(0,r.isUndefined)(t)||((0,r.isArray)(t?.children)||(t.children=[]),t.children.push(e))})),i};t.getModelDefinitionKeys=e=>{const t={},i=e=>{if((0,r.isString)(e?.$ref)){const i=e?.$ref.replace("#/definitions/","");t[i]=!0}(0,r.isObject)(e.properties)&&Object.values(e.properties).forEach((e=>{i(e)})),"array"===e?.type&&(0,r.isObject)(e?.items)&&i(e?.items),"oneOf"===e?.type&&(0,r.isArray)(e?.oneOf)&&e?.oneOf?.forEach((e=>{i(e)})),"anyOf"===e?.type&&(0,r.isArray)(e?.anyOf)&&e?.anyOf?.forEach((e=>{i(e)})),"allOf"===e?.type&&(0,r.isArray)(e?.allOf)&&e?.allOf?.forEach((e=>{i(e)}))};return i(e),t}},function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.PluginModule=void 0;const o=i(3),s=i(19),n=i(9);let a=class{};t.PluginModule=a,t.PluginModule=a=r([(0,o.Global)(),(0,o.Module)({providers:[s.ToolsService,n.RedisService],exports:[s.ToolsService,n.RedisService],imports:[]})],a)},function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.OpenApiModule=void 0;const o=i(3),s=i(61),n=i(108),a=i(109),c=i(63);let d=class{};t.OpenApiModule=d,t.OpenApiModule=d=r([(0,o.Module)({imports:[s.PrismaModule,c.AuthModule],controllers:[a.OpenApiController],providers:[n.OpenApiService],exports:[n.OpenApiService]})],d)},function(e,t,i){var r,o,s=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.OpenApiService=void 0;const a=i(3),c=i(17),d=i(27),p=i(25);let u=class{constructor(e,t){this.prismaService=e,this.authService=t}async getList(e){return await this.prismaService.userOpenApis.findMany({where:{uid:e}})}async createOpenApi(e){const t=this.authService.getOpenApiToken(e.user_id,e.expire_days),i={id:e.id,uid:e.user_id,name:e.name,token:t,create_time:(0,p.default)().format(),expire_time:(0,p.default)().add(e?.expire_days?.value,e?.expire_days?.unit).format()};return await this.prismaService.userOpenApis.create({data:i})}async deleteOpenApi(e){const t=await this.prismaService.userOpenApis.findUnique({where:{id:e.id}});if(!t||t.uid!==e.user_id)throw new a.HttpException("操作无效",a.HttpStatus.OK);return await this.prismaService.userOpenApis.delete({where:{id:e.id}}),!0}};t.OpenApiService=u,t.OpenApiService=u=s([(0,a.Injectable)(),n("design:paramtypes",["function"==typeof(r=void 0!==c.PrismaService&&c.PrismaService)?r:Object,"function"==typeof(o=void 0!==d.AuthService&&d.AuthService)?o:Object])],u)},function(e,t,i){var r,o=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OpenApiController=void 0;const a=i(3),c=i(56),d=i(108);let p=class{constructor(e){this.openApiService=e}getList(e){const t=e.user.sub;return(0,c.Send)(this.openApiService.getList(t))}createParams(e,t){const i={...t,user_id:e.user.sub};return(0,c.Send)(this.openApiService.createOpenApi(i))}deleteParams(e,t){const i={user_id:e.user.sub,id:t};return(0,c.Send)(this.openApiService.deleteOpenApi(i))}};t.OpenApiController=p,o([(0,a.Get)(),n(0,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",void 0)],p.prototype,"getList",null),o([(0,a.Post)(),n(0,(0,a.Req)()),n(1,(0,a.Body)()),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",void 0)],p.prototype,"createParams",null),o([(0,a.Delete)("/:id"),n(0,(0,a.Req)()),n(1,(0,a.Param)("id")),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",void 0)],p.prototype,"deleteParams",null),t.OpenApiController=p=o([(0,a.Controller)({version:"1.0",path:"open-apis"}),s("design:paramtypes",["function"==typeof(r=void 0!==d.OpenApiService&&d.OpenApiService)?r:Object])],p)},function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.InvitesModule=void 0;const o=i(3),s=i(61),n=i(111),a=i(112),c=i(4),d=i(84);let p=class{};t.InvitesModule=p,t.InvitesModule=p=r([(0,o.Module)({imports:[s.PrismaModule,c.UserModule,d.NotificationModule],controllers:[n.InvitesController],providers:[a.InvitesService],exports:[a.InvitesService]})],p)},function(e,t,i){var r,o=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.InvitesController=void 0;const a=i(3),c=i(56),d=i(112),p=i(59);let u=class{constructor(e){this.invitesService=e}createInvites(e,t){const i={...e,user_id:t.user.sub};return(0,c.Send)(this.invitesService.createInvites(i))}getInviteDetail(e){return(0,c.Send)(this.invitesService.getInviteDetail(e))}acceptInvite(e,t){const i={token:e,user_id:t.user.sub};return(0,c.Send)(this.invitesService.acceptInvite(i))}};t.InvitesController=u,o([(0,a.Post)(),n(0,(0,a.Body)()),n(1,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",void 0)],u.prototype,"createInvites",null),o([(0,p.Public)(),(0,a.Get)("/detail/:token"),n(0,(0,a.Param)("token")),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",void 0)],u.prototype,"getInviteDetail",null),o([(0,a.Post)("/accept/:token"),n(0,(0,a.Param)("token")),n(1,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",void 0)],u.prototype,"acceptInvite",null),t.InvitesController=u=o([(0,a.Controller)({version:"1.0",path:"invites"}),s("design:paramtypes",["function"==typeof(r=void 0!==d.InvitesService&&d.InvitesService)?r:Object])],u)},function(e,t,i){var r,o,s,n=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.InvitesService=void 0;const c=i(3),d=i(17),p=i(6),u=i(16),l=i(25),f=i(7),v=i(40);let _=class{constructor(e,t,i){this.prismaService=e,this.userService=t,this.notificationService=i}async createInvites(e){const t=await this.userService.getUserTeamRole(e);if(![3,4].includes(t))throw new c.HttpException("仅团队所有者或管理员可操作",c.HttpStatus.OK);const i={token:new u.default({length:32}).rnd(),creater_id:e.user_id,team_id:e.team_id,team_role:e.team_role,projects:e.projects,type:e.type,emails:e.emails,expire_time:(0,l.default)().add(7,"d").format()};return await this.prismaService.invitation.create({data:i})}async getInviteBase(e){return await this.prismaService.invitation.findFirst({where:{token:e}})}async getInviteDetail(e){const t=await this.getInviteBase(e),i=await this.prismaService.users.findUnique({select:{nick_name:!0},where:{uid:t.creater_id}});if(!i)throw new c.HttpException("分享无效",c.HttpStatus.OK);const r=await this.prismaService.teams.findUnique({select:{name:!0},where:{team_id:t.team_id}});if(!r)throw new c.HttpException("分享无效",c.HttpStatus.OK);return{...t,creater_name:i.nick_name,team_name:r.name}}async acceptInvite(e){const t=await this.getInviteBase(e.token);if((0,l.default)().unix()>(0,l.default)(t.expire_time).unix())throw new c.HttpException("分享已过期",c.HttpStatus.OK);if(t.creater_id===e.user_id)throw new c.HttpException("不能加入自己分享的团队",c.HttpStatus.OK);if(await this.prismaService.joinedInvitation.findUnique({where:{token_user_id:{token:e.token,user_id:e.user_id}}}))throw new c.HttpException("不能重复加入",c.HttpStatus.OK);const i=await this.prismaService.userTeams.upsert({where:{team_id_uid:{uid:e.user_id,team_id:t.team_id}},update:{role:t.team_role},create:{uid:e.user_id,team_id:t.team_id,role:t.team_role,join_time:(0,l.default)().format()},select:{team:{select:{name:!0}}}});if(await this.notificationService.addNodify({uid:e.user_id,title:"协作邀请",content:`您已加入团队 ${i?.team?.name}`,type:2}),(0,f.isPlainObject)(t?.projects)&&!(0,f.isEmpty)(t?.projects)){const i=Object.entries(t?.projects).map((([e,t])=>({id:e,role:t})));for(const t of i){const i=await this.prismaService.userProjects.upsert({where:{project_id_uid:{project_id:t.id,uid:e.user_id}},update:{role:t.role,join_time:(0,l.default)().format()},create:{uid:e.user_id,project_id:t.id,role:t.role,join_time:(0,l.default)().format()},select:{project:{select:{name:!0}}}});await this.notificationService.addNodify({uid:e.user_id,title:"协作邀请",content:`您已加入项目 ${i?.project?.name}`,type:2})}}return await this.prismaService.joinedInvitation.create({data:{token:e.token,user_id:e.user_id}}),!0}};t.InvitesService=_,t.InvitesService=_=n([(0,c.Injectable)(),a("design:paramtypes",["function"==typeof(r=void 0!==d.PrismaService&&d.PrismaService)?r:Object,"function"==typeof(o=void 0!==p.UserService&&p.UserService)?o:Object,"function"==typeof(s=void 0!==v.NotificationService&&v.NotificationService)?s:Object])],_)},function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.ModelsModule=void 0;const o=i(3),s=i(61),n=i(114),a=i(115),c=i(4),d=i(100);let p=class{};t.ModelsModule=p,t.ModelsModule=p=r([(0,o.Module)({imports:[d.FileStoreModule,s.PrismaModule,c.UserModule],controllers:[n.ModelsController],providers:[a.ModelsService],exports:[]})],p)},function(e,t,i){var r,o=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ModelsController=void 0;const a=i(3),c=i(56),d=i(115);let p=class{constructor(e){this.modelService=e}saveModel(e,t,i){const r={...i,project_id:e,user_id:t?.user?.sub};return(0,c.Send)(this.modelService.saveModel(r))}getModelDetail(e,t,i){const r={project_id:e,user_id:i?.user?.sub,id:t};return(0,c.Send)(this.modelService.getModelDetail(r))}batchGetModelDetail(e,t,i){const r={project_id:e,user_id:t?.user?.sub,...i};return(0,c.Send)(this.modelService.batchGetModelDetail(r))}getModelDescribes(e,t){const i={project_id:e,user_id:t?.user?.sub};return(0,c.Send)(this.modelService.getModelDescribes(i))}deleteModel(e,t,i){const r={project_id:e,user_id:i?.user?.sub,id:t};return(0,c.Send)(this.modelService.deleteModel(r))}batchDeleteModel(e,t,i){const r={...i,project_id:e,user_id:t?.user?.sub};return(0,c.Send)(this.modelService.batchDeleteModel(r))}sortModelList(e,t,i){const r={...i,project_id:e,user_id:t?.user?.sub};return(0,c.Send)(this.modelService.sortModelList(r))}batchSaveModel(e,t,i){const r={project_id:e,user_id:t?.user?.sub,model_list:i};return(0,c.Send)(this.modelService.batchSaveModel(r))}};t.ModelsController=p,o([(0,a.Put)("/save"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Req)()),n(2,(0,a.Body)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"saveModel",null),o([(0,a.Get)("/:id"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Param)("id")),n(2,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"getModelDetail",null),o([(0,a.Post)("/batch-details"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Req)()),n(2,(0,a.Body)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"batchGetModelDetail",null),o([(0,a.Get)(),n(0,(0,a.Param)("project_id")),n(1,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",void 0)],p.prototype,"getModelDescribes",null),o([(0,a.Delete)("/:id"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Param)("id")),n(2,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"deleteModel",null),o([(0,a.Post)("/batch-delete"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Req)()),n(2,(0,a.Body)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"batchDeleteModel",null),o([(0,a.Post)("/sort-list"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Req)()),n(2,(0,a.Body)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"sortModelList",null),o([(0,a.Post)("/batch-save"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Req)()),n(2,(0,a.Body)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"batchSaveModel",null),t.ModelsController=p=o([(0,a.Controller)({version:"1.0",path:"projects/:project_id/models"}),s("design:paramtypes",["function"==typeof(r=void 0!==d.ModelsService&&d.ModelsService)?r:Object])],p)},function(e,t,i){var r,o,s,n,a,c=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ModelsService=void 0;const p=i(3),u=i(7),l=i(6),f=i(50),v=i(9),_=i(19),h=i(17),y=i(25),m=i(20);let S=class{constructor(e,t,i,r,o){this.fileStoreService=e,this.prismaService=t,this.redisService=i,this.userService=r,this.toolsService=o}async getProjectBucketName(e){const t=`PROJECT_BUCKET${e}`,i=await this.redisService.get(t);if((0,u.isString)(i))return i;const r=await this.prismaService.projects.findUnique({where:{project_id:e},select:{bucket_id:!0}});return await this.redisService.set(t,r.bucket_id),r.bucket_id}async saveModelData(e,t){const{project_id:i,bucket_name:r,user_id:o}=t;let s={etag:null,versionId:null};const n=(0,y.default)().format();if((0,u.isPlainObject)(e?.data)){const t=JSON.stringify(e.data);s=await this.fileStoreService.saveData(r,e.id,t)}else s.versionId=(0,m.strToMd5)(JSON.stringify({name:e?.name,parent_id:e?.parent_id,project_id:i,sort:e?.sort}));const a={...(0,u.pick)(e,["parent_id","name","sort","describe"]),etag:s.etag,update_time:n,updater_id:o,version:s?.versionId},c={...(0,u.pick)(e,["id","parent_id","name","data_type","sort","describe"]),db_id:this.toolsService.getUniqueID(),project_id:i,etag:s.etag,version:s.versionId,create_time:n,creator_id:o,update_time:null,updater_id:null,status:1};return{...await this.prismaService.dataModel.upsert({where:{id:e.id},update:a,create:c}),data:e.data}}async saveModel(e){const t=await this.userService.getUserProjectRole(e);if(![2,6].includes(t))throw new p.HttpException("未授权",p.HttpStatus.OK);const i=await this.getProjectBucketName(e.project_id);return await this.saveModelData(e,{project_id:e.project_id,bucket_name:i,user_id:e.user_id})}async getModelDetail(e){const t=await this.userService.getUserProjectRole(e);if(![4,6].includes(t))throw new p.HttpException("未授权",p.HttpStatus.OK);const i=await this.prismaService.dataModel.findUnique({where:{id:e.id}});if((0,u.isNull)(i)||[-1,-99].includes(i?.status))throw new p.HttpException("数据不存在或已被删除",p.HttpStatus.OK);const r=await this.getProjectBucketName(e.project_id),o=await this.fileStoreService.getData(r,e.id);return{...i,data:o}}async batchGetModelDetail(e){const t=await this.userService.getUserProjectRole(e),i=await this.getProjectBucketName(e.project_id);if(![4,6].includes(t))throw new p.HttpException("未授权",p.HttpStatus.OK);if(e.ids?.length>100)throw new p.HttpException("单次最大不能查询超100条数据",p.HttpStatus.OK);const r=await this.prismaService.dataModel.findMany({where:{id:{in:e.ids}}}),o=[];for(const e of r){try{const t=await this.fileStoreService.getData(i,e.id);e.data=t}catch(e){}o.push(e)}return o}async getModelDescribes(e){const t=await this.userService.getUserProjectRole(e);if(![4,6].includes(t))throw new p.HttpException("未授权",p.HttpStatus.OK);return await this.prismaService.dataModel.findMany({select:{id:!0,name:!0,etag:!0,version:!0,data_type:!0,status:!0,sort:!0},where:{project_id:e.project_id,status:{in:[1,2,-1]}}})}async deleteModel(e){const t=await this.userService.getUserProjectRole(e);if(![2,6].includes(t))throw new p.HttpException("未授权",p.HttpStatus.OK);return await this.prismaService.dataModel.update({where:{id:e.id},data:{status:-1}}),!0}async batchDeleteModel(e){const t=await this.userService.getUserProjectRole(e);if(![2,6].includes(t))throw new p.HttpException("未授权",p.HttpStatus.OK);return await this.prismaService.dataModel.updateMany({where:{id:{in:e.ids}},data:{status:-1}})}async sortModelList(e){const t=await this.userService.getUserProjectRole(e);if(![2,6].includes(t))throw new p.HttpException("未授权",p.HttpStatus.OK);if(await this.prismaService.dataModel.update({where:{id:e.sort_id},data:{parent_id:e.new_parent_id}}),!(0,u.isArray)(e.new_sort_list))return!0;for(const t of e.new_sort_list)await this.prismaService.dataModel.update({where:{id:t.id},data:{sort:t.sort}});return!0}async batchSaveModel(e){const t=await this.userService.getUserProjectRole(e);if(![2,6].includes(t))throw new p.HttpException("未授权",p.HttpStatus.OK);if(!(0,u.isArray)(e.model_list)||(0,u.isEmpty)(e.model_list))return!1;const i=await this.getProjectBucketName(e.project_id);for(const t of e.model_list)await this.saveModelData(t,{project_id:e.project_id,user_id:e.user_id,bucket_name:i});return!0}};t.ModelsService=S,t.ModelsService=S=c([(0,p.Injectable)(),d("design:paramtypes",["function"==typeof(r=void 0!==f.FileStoreService&&f.FileStoreService)?r:Object,"function"==typeof(o=void 0!==h.PrismaService&&h.PrismaService)?o:Object,"function"==typeof(s=void 0!==v.RedisService&&v.RedisService)?s:Object,"function"==typeof(n=void 0!==l.UserService&&l.UserService)?n:Object,"function"==typeof(a=void 0!==_.ToolsService&&_.ToolsService)?a:Object])],S)},function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.TestingModule=void 0;const o=i(3),s=i(61),n=i(117),a=i(118),c=i(100),d=i(4),p=i(119);let u=class{};t.TestingModule=u,t.TestingModule=u=r([(0,o.Module)({imports:[c.FileStoreModule,s.PrismaModule,d.UserModule,p.ReportsModule],controllers:[n.TestingController],providers:[a.TestingService],exports:[]})],u)},function(e,t,i){var r,o=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.TestingController=void 0;const a=i(3),c=i(56),d=i(118);let p=class{constructor(e){this.testingService=e}saveData(e,t,i){const r={...i,project_id:e,user_id:t.user.sub};return(0,c.Send)(this.testingService.saveTesting(r))}getList(e,t){const i={project_id:e,user_id:t.user.sub};return(0,c.Send)(this.testingService.getTestingDescribes(i))}getDetail(e,t,i){const r={test_id:t,project_id:e,user_id:i.user.sub};return(0,c.Send)(this.testingService.getTestingDetail(r))}getBatchDetails(e,t,i){const r={...i,project_id:e,user_id:t.user.sub};return(0,c.Send)(this.testingService.getBatchDetails(r))}batchSaveTestings(e,t,i){const r={list:i,project_id:e,user_id:t.user.sub};return(0,c.Send)(this.testingService.batchSaveTestings(r))}deleteTesting(e,t,i){const r={test_id:t,project_id:e,user_id:i.user.sub};return(0,c.Send)(this.testingService.deleteTesting(r))}batchDeleteTestings(e,t,i){const r={...i,project_id:e,user_id:t.user.sub};return(0,c.Send)(this.testingService.batchDeleteTestings(r))}sortTestingList(e,t,i){const r={...i,project_id:e,user_id:t.user.sub};return(0,c.Send)(this.testingService.sortTestingList(r))}updateTesting(e,t,i,r){const o={...r,test_id:t,project_id:e,user_id:i.user.sub};return(0,c.Send)(this.testingService.updateTesting(o))}};t.TestingController=p,o([(0,a.Put)("/save"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Req)()),n(2,(0,a.Body)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"saveData",null),o([(0,a.Get)(),n(0,(0,a.Param)("project_id")),n(1,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",void 0)],p.prototype,"getList",null),o([(0,a.Get)("/detail/:test_id"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Param)("test_id")),n(2,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"getDetail",null),o([(0,a.Post)("/batch-details"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Req)()),n(2,(0,a.Body)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"getBatchDetails",null),o([(0,a.Post)("/batch-save"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Req)()),n(2,(0,a.Body)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"batchSaveTestings",null),o([(0,a.Delete)("/:test_id"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Param)("test_id")),n(2,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"deleteTesting",null),o([(0,a.Post)("/batch-delete"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Req)()),n(2,(0,a.Body)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"batchDeleteTestings",null),o([(0,a.Post)("/sort-list"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Req)()),n(2,(0,a.Body)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"sortTestingList",null),o([(0,a.Patch)("/:test_id"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Param)("test_id")),n(2,(0,a.Req)()),n(3,(0,a.Body)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"updateTesting",null),t.TestingController=p=o([(0,a.Controller)({version:"1.0",path:"projects/:project_id/testing"}),s("design:paramtypes",["function"==typeof(r=void 0!==d.TestingService&&d.TestingService)?r:Object])],p)},function(e,t,i){var r,o,s,n,a,c=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.TestingService=void 0;const p=i(3),u=i(7),l=i(6),f=i(25),v=i(50),_=i(19),h=i(9),y=i(17);let m=class{constructor(e,t,i,r,o){this.fileStoreService=e,this.prismaService=t,this.redisService=i,this.userService=r,this.toolsService=o}async getProjectBucketName(e){const t=`PROJECT_BUCKET${e}`,i=await this.redisService.get(t);if((0,u.isString)(i))return i;const r=await this.prismaService.projects.findUnique({where:{project_id:e},select:{bucket_id:!0}});return await this.redisService.set(t,r.bucket_id),r.bucket_id}async saveData(e,t){const{project_id:i,bucket_name:r,user_id:o}=t,s=JSON.stringify(e?.data),n=(0,f.default)().format(),a=await this.fileStoreService.saveData(r,e.test_id,s),c={...(0,u.pick)(e,["parent_id","name","sort"]),etag:a.etag,update_time:n,updater_id:o,version:a?.versionId},d={...(0,u.pick)(e,["test_id","parent_id","name","type","sort"]),db_id:this.toolsService.getUniqueID(),project_id:i,etag:a.etag,version:a.versionId,create_time:n,creator_id:o,update_time:null,updater_id:null,status:1};return await this.prismaService.testing.upsert({where:{test_id:e.test_id},update:c,create:d})}async saveTesting(e){const t=await this.userService.getUserProjectRole(e);if(![2,6].includes(t))throw new p.HttpException("未授权",p.HttpStatus.OK);const i=await this.getProjectBucketName(e.project_id);return await this.saveData(e,{project_id:e.project_id,bucket_name:i,user_id:e.user_id})}async getTestingDescribes(e){const t=await this.userService.getUserProjectRole(e);if(![4,6].includes(t))throw new p.HttpException("未授权",p.HttpStatus.OK);return await this.prismaService.testing.findMany({select:{test_id:!0,name:!0,etag:!0,version:!0,type:!0,status:!0,sort:!0},where:{project_id:e.project_id,status:{in:[1,-1]}}})}async getTestingDetail(e){const t=await this.userService.getUserProjectRole(e);if(![4,6].includes(t))throw new p.HttpException("未授权",p.HttpStatus.OK);const i=await this.prismaService.testing.findUnique({where:{test_id:e.test_id}});if((0,u.isNull)(i)||[-1,-99].includes(i?.status))throw new p.HttpException("数据不存在或已被删除",p.HttpStatus.OK);const r=await this.getProjectBucketName(e.project_id),o=await this.fileStoreService.getData(r,e.test_id);return{...i,data:o}}async getBatchDetails(e){const t=await this.userService.getUserProjectRole(e);if(![4,6].includes(t))throw new p.HttpException("未授权",p.HttpStatus.OK);if(e.test_ids?.length>100)throw new p.HttpException("单次最大不能查询超100条数据",p.HttpStatus.OK);const i=await this.getProjectBucketName(e.project_id),r=await this.prismaService.testing.findMany({where:{test_id:{in:e.test_ids}}}),o=[];for(const e of r){const t=await this.fileStoreService.getData(i,e.test_id);o.push({...e,data:t})}return o}async batchSaveTestings(e){const t=await this.userService.getUserProjectRole(e);if(![2,6].includes(t))throw new p.HttpException("未授权",p.HttpStatus.OK);if(!(0,u.isArray)(e.list)||(0,u.isEmpty)(e.list))return!1;const i=await this.getProjectBucketName(e.project_id);for(const t of e.list)await this.saveData(t,{project_id:e.project_id,user_id:e.user_id,bucket_name:i});return!0}async deleteTesting(e){const t=await this.userService.getUserProjectRole(e);if(![2,6].includes(t))throw new p.HttpException("未授权",p.HttpStatus.OK);return await this.prismaService.testing.update({where:{test_id:e.test_id},data:{status:-1}}),!0}async batchDeleteTestings(e){const t=await this.userService.getUserProjectRole(e);if(![2,6].includes(t))throw new p.HttpException("未授权",p.HttpStatus.OK);return await this.prismaService.testing.updateMany({where:{test_id:{in:e.test_ids}},data:{status:-1}})}async sortTestingList(e){const t=await this.userService.getUserProjectRole(e);if(![2,6].includes(t))throw new p.HttpException("未授权",p.HttpStatus.OK);if(await this.prismaService.testing.update({where:{test_id:e.sort_id},data:{parent_id:e.new_parent_id}}),!(0,u.isArray)(e.new_sort_list))return!0;for(const t of e.new_sort_list)await this.prismaService.testing.update({where:{test_id:t.id},data:{sort:t.sort}});return!0}async updateTesting(e){const t=await this.userService.getUserProjectRole(e);if(![2,6].includes(t))throw new p.HttpException("未授权",p.HttpStatus.OK);const i=(0,u.pick)(e,["name","parent_id"]);return await this.prismaService.testing.update({where:{test_id:e.test_id},data:i})}};t.TestingService=m,t.TestingService=m=c([(0,p.Injectable)(),d("design:paramtypes",["function"==typeof(r=void 0!==v.FileStoreService&&v.FileStoreService)?r:Object,"function"==typeof(o=void 0!==y.PrismaService&&y.PrismaService)?o:Object,"function"==typeof(s=void 0!==h.RedisService&&h.RedisService)?s:Object,"function"==typeof(n=void 0!==l.UserService&&l.UserService)?n:Object,"function"==typeof(a=void 0!==_.ToolsService&&_.ToolsService)?a:Object])],m)},function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.ReportsModule=void 0;const o=i(3),s=i(61),n=i(4),a=i(120),c=i(121),d=i(100);let p=class{};t.ReportsModule=p,t.ReportsModule=p=r([(0,o.Module)({imports:[d.FileStoreModule,s.PrismaModule,n.UserModule],controllers:[c.ReportsController],providers:[a.ReportsService],exports:[a.ReportsService]})],p)},function(e,t,i){var r,o,s,n,a,c=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ReportsService=void 0;const p=i(3),u=i(17),l=i(7),f=i(6),v=i(19),_=i(50),h=i(9);let y=class{constructor(e,t,i,r,o){this.fileStoreService=e,this.prismaService=t,this.redisService=i,this.userService=r,this.toolsService=o}async getProjectBucketName(e){const t=`PROJECT_BUCKET${e}`,i=await this.redisService.get(t);if((0,l.isString)(i))return i;const r=await this.prismaService.projects.findUnique({where:{project_id:e},select:{bucket_id:!0}});return await this.redisService.set(t,r.bucket_id),r.bucket_id}async saveReport(e){const t=await this.userService.getUserProjectRole(e);if(![2,6].includes(t))throw new p.HttpException("未授权",p.HttpStatus.OK);const i=await this.getProjectBucketName(e.project_id);if((0,l.isObject)(e?.results)&&!(0,l.isEmpty)(e?.results)){const t=JSON.stringify(e?.results);await this.fileStoreService.saveData(i,e.report_id,t)}const r=(0,l.pick)(e,["project_id","test_id","report_id","name","progress","status","user_id","user_name","env_id","env_name","cost_time","create_time","api_success_rate","assert_success_rate","finish_time"]);return await this.prismaService.testingReports.create({data:{db_id:this.toolsService.getUniqueID(),...r}})}async updateReport(e){const t=await this.userService.getUserProjectRole(e);if(![2,6].includes(t))throw new p.HttpException("未授权",p.HttpStatus.OK);const i=await this.getProjectBucketName(e.project_id);if((0,l.isObject)(e?.results)&&!(0,l.isEmpty)(e?.results)){const t=JSON.stringify(e?.results);await this.fileStoreService.saveData(i,e.report_id,t)}const r=(0,l.pick)(e,["progress","status","cost_time","finish_time","api_success_rate","assert_success_rate"]);return await this.prismaService.testingReports.update({where:{report_id:e.report_id},data:r})}async getReports(e){const t=await this.userService.getUserProjectRole(e);if(![4,6].includes(t))throw new p.HttpException("未授权",p.HttpStatus.OK);return await this.prismaService.testingReports.findMany({where:{project_id:e.project_id,test_id:e.test_id},orderBy:{create_time:"desc"}})}async getReportDetail(e){const t=await this.userService.getUserProjectRole(e);if(![4,6].includes(t))throw new p.HttpException("未授权",p.HttpStatus.OK);const i=await this.prismaService.testingReports.findUnique({where:{report_id:e.report_id}});if((0,l.isNull)(i)||"deleted"===i?.status)throw new p.HttpException("数据不存在或已被删除",p.HttpStatus.OK);const r=await this.getProjectBucketName(e.project_id),o=await this.fileStoreService.getData(r,e.report_id);return{...i,results:o}}async deleteReport(e){const t=await this.userService.getUserProjectRole(e);if(![2,6].includes(t))throw new p.HttpException("未授权",p.HttpStatus.OK);await this.prismaService.testingReports.update({where:{report_id:e.report_id,project_id:e.project_id},data:{status:"deleted"}});const i=await this.getProjectBucketName(e.project_id);return await this.fileStoreService.deleteData(i,e.report_id),!0}};t.ReportsService=y,t.ReportsService=y=c([(0,p.Injectable)(),d("design:paramtypes",["function"==typeof(r=void 0!==_.FileStoreService&&_.FileStoreService)?r:Object,"function"==typeof(o=void 0!==u.PrismaService&&u.PrismaService)?o:Object,"function"==typeof(s=void 0!==h.RedisService&&h.RedisService)?s:Object,"function"==typeof(n=void 0!==f.UserService&&f.UserService)?n:Object,"function"==typeof(a=void 0!==v.ToolsService&&v.ToolsService)?a:Object])],y)},function(e,t,i){var r,o=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ReportsController=void 0;const a=i(3),c=i(120),d=i(56);let p=class{constructor(e){this.reportsService=e}saveReport(e,t,i,r){const o={...r,project_id:e,test_id:t,user_id:i.user.sub};return(0,d.Send)(this.reportsService.saveReport(o))}getReports(e,t,i){const r={project_id:e,test_id:t,user_id:i.user.sub};return(0,d.Send)(this.reportsService.getReports(r))}updateReport(e,t,i,r,o){const s={...o,report_id:i,project_id:e,test_id:t,user_id:r.user.sub};return(0,d.Send)(this.reportsService.updateReport(s))}getReportDetail(e,t,i){const r={report_id:t,project_id:e,user_id:i.user.sub};return(0,d.Send)(this.reportsService.getReportDetail(r))}deleteReport(e,t,i){const r={report_id:t,project_id:e,user_id:i.user.sub};return(0,d.Send)(this.reportsService.deleteReport(r))}saveReportparts(){return"分块保存测试报告片段"}};t.ReportsController=p,o([(0,a.Post)("/save-report"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Param)("test_id")),n(2,(0,a.Req)()),n(3,(0,a.Body)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"saveReport",null),o([(0,a.Get)(),n(0,(0,a.Param)("project_id")),n(1,(0,a.Param)("test_id")),n(2,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"getReports",null),o([(0,a.Patch)("/:report_id"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Param)("test_id")),n(2,(0,a.Param)("report_id")),n(3,(0,a.Req)()),n(4,(0,a.Body)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"updateReport",null),o([(0,a.Get)("/:report_id"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Param)("report_id")),n(2,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"getReportDetail",null),o([(0,a.Delete)("/:report_id"),n(0,(0,a.Param)("project_id")),n(1,(0,a.Param)("report_id")),n(2,(0,a.Req)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],p.prototype,"deleteReport",null),o([(0,a.Post)("/save-report-parts"),s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",void 0)],p.prototype,"saveReportparts",null),t.ReportsController=p=o([(0,a.Controller)({version:"1.0",path:"/projects/:project_id/testing/:test_id/reports"}),s("design:paramtypes",["function"==typeof(r=void 0!==c.ReportsService&&c.ReportsService)?r:Object])],p)},function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.FilesModule=void 0;const o=i(3),s=i(61),n=i(123),a=i(125),c=i(100);let d=class{};t.FilesModule=d,t.FilesModule=d=r([(0,o.Module)({imports:[s.PrismaModule,c.FileStoreModule],controllers:[n.FilesController],providers:[a.FilesService],exports:[]})],d)},function(e,t,i){var r,o,s,n=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.FilesController=void 0;const d=i(3),p=i(124),u=i(56),l=i(125),f=i(126),v=i(59);let _=class{constructor(e){this.filesService=e}uploadFile(e,t){return(0,u.Send)(this.filesService.uploadFile(e,{file_name:t?.file_name,bucket_name:"assets"}))}getFile(e){try{const t=this.filesService.getFile("assets",e);if(null===t)throw new d.NotFoundException;return new d.StreamableFile(t)}catch(e){throw new d.NotFoundException}}};t.FilesController=_,n([(0,d.Post)("upload"),(0,d.UseInterceptors)((0,p.FileInterceptor)("file")),c(0,(0,d.UploadedFile)()),c(1,(0,d.Query)()),a("design:type",Function),a("design:paramtypes",["function"==typeof(s=void 0!==f.Express&&void 0!==(o=f.Express.Multer)&&o.File)?s:Object,Object]),a("design:returntype",void 0)],_.prototype,"uploadFile",null),n([(0,v.Public)(),(0,d.Get)("/assets/:file_name"),c(0,(0,d.Param)("file_name")),a("design:type",Function),a("design:paramtypes",[String]),a("design:returntype",void 0)],_.prototype,"getFile",null),t.FilesController=_=n([(0,d.Controller)({version:"1.0",path:"files"}),a("design:paramtypes",["function"==typeof(r=void 0!==l.FilesService&&l.FilesService)?r:Object])],_)},e=>{e.exports=require("@nestjs/platform-express")},function(e,t,i){var r,o,s=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.FilesService=void 0;const a=i(3),c=i(17),d=i(50),p=i(14);let u=class{constructor(e,t){this.prismaService=e,this.fileStoreService=t}async uploadFile(e,t){const{bucket_name:i="assets",file_name:r}=t,o=r??(0,p.v4)();return{bucket_name:i,file_name:o,...await this.fileStoreService.saveBuffer(i,`${o}`,e.buffer)}}getFile(e,t,i){return this.fileStoreService.getBuffer(e,t,i)}};t.FilesService=u,t.FilesService=u=s([(0,a.Injectable)(),n("design:paramtypes",["function"==typeof(r=void 0!==c.PrismaService&&c.PrismaService)?r:Object,"function"==typeof(o=void 0!==d.FileStoreService&&d.FileStoreService)?o:Object])],u)},e=>{e.exports=require("express")},function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.HelpModule=void 0;const o=i(3),s=i(61),n=i(128),a=i(129),c=i(4),d=i(84),p=i(28),u=i(62);let l=class{};t.HelpModule=l,t.HelpModule=l=r([(0,o.Module)({imports:[s.PrismaModule,c.UserModule,d.NotificationModule,p.JwtModule.register({}),u.SmsModule],controllers:[n.HelpController],providers:[a.HelpService],exports:[a.HelpService]})],l)},function(e,t,i){var r,o=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.HelpController=void 0;const a=i(3),c=i(56),d=i(129),p=i(59);let u=class{constructor(e){this.helpService=e}findPassword(e){return(0,c.Send)(this.helpService.findPassword(e))}getUserProfileByToken(e){return(0,c.Send)(this.helpService.getUserProfileByToken(e))}verifySmsCode(e){return(0,c.Send)(this.helpService.verifySmsCode(e))}resetPassword(e){return(0,c.Send)(this.helpService.resetPassword(e))}};t.HelpController=u,o([(0,p.Public)(),(0,a.Post)("/find-password"),n(0,(0,a.Body)()),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",void 0)],u.prototype,"findPassword",null),o([(0,p.Public)(),(0,a.Get)("/user-profile-token"),n(0,(0,a.Query)("token")),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",void 0)],u.prototype,"getUserProfileByToken",null),o([(0,p.Public)(),(0,a.Post)("/verify-sms-code"),n(0,(0,a.Body)()),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",void 0)],u.prototype,"verifySmsCode",null),o([(0,p.Public)(),(0,a.Post)("/reset-password"),n(0,(0,a.Body)()),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",void 0)],u.prototype,"resetPassword",null),t.HelpController=u=o([(0,a.Controller)({version:"1.0",path:"help"}),s("design:paramtypes",["function"==typeof(r=void 0!==d.HelpService&&d.HelpService)?r:Object])],u)},function(e,t,i){var r,o,s,n,a,c,d,p=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.HelpService=void 0;const l=i(3),f=i(17),v=i(6),_=i(40),h=i(7),y=i(28),m=i(10),S=i(16),j=i(9),g=i(130),b=i(8);let w=class{constructor(e,t,i,r,o,s,n){this.prismaService=e,this.userService=t,this.notificationService=i,this.jwtService=r,this.configService=o,this.smsService=s,this.redisService=n}async findPasswordByEmail(e){const t=await this.prismaService.users.findFirst({where:{email:e}});if((0,h.isNull)(t))throw new l.HttpException("账户不存在",l.HttpStatus.OK);const i=this.jwtService.sign({sub:t.uid},{secret:this.configService.get("JWT_ACCESS_SECRET"),expiresIn:"24h"}),r=`${this.configService.get("APP_BASE_URL")}/register/new-password?token=${i}`,o=g.FIND_PASSWORD_CONTENT.replaceAll("{link}",r);return await this.smsService.sendEmailMessage(e,"【Hapydev】 找回登录密码",o),!0}async findPasswordByPhone(e){const t=await this.prismaService.users.findFirst({where:{phone:e}});if((0,h.isNull)(t))throw new l.HttpException("账户不存在",l.HttpStatus.OK);const i=`FIND_PASSWORD_${e}`;if(await this.redisService.get(i))throw new l.HttpException("您的操作过于频繁，请稍后再试",l.HttpStatus.OK);await this.redisService.set(i,!0,60);const r=new S.default({length:6,dictionary:"number"}).rnd();return await this.redisService.set("VERIFY_FIND_PASSWORD"+e,r,300),await this.smsService.sendPhoneVerifyCode(e,r,3),!0}async findPassword(e){return"email"===e.type?this.findPasswordByEmail(e?.email):this.findPasswordByPhone(e?.phone)}async getUserProfileByToken(e){this.jwtService.verify(e,{secret:this.configService.get("JWT_ACCESS_SECRET")});const t=this.jwtService.decode(e);if(!(0,h.isString)(t?.sub))throw new l.HttpException("账户不存在",l.HttpStatus.OK);const i=await this.userService.getUserProfile(t?.sub);return(0,h.pick)(i,["uid","nick_name"])}async verifySmsCode(e){const{phone:t,code:i}=e,r="VERIFY_FIND_PASSWORD"+t,o=await this.redisService.get(r);if(6!==i?.length&&o!==i)throw await this.redisService.del(r),new l.HttpException("验证码错误",l.HttpStatus.OK);const s=await this.prismaService.users.findFirst({where:{phone:t}});if((0,h.isNull)(s))throw new l.HttpException("账户不存在",l.HttpStatus.OK);return this.jwtService.sign({sub:s.uid},{secret:this.configService.get("JWT_ACCESS_SECRET"),expiresIn:"24h"})}async resetPassword(e){const{token:t,password:i,password_confirm:r}=e;this.jwtService.verify(t,{secret:this.configService.get("JWT_ACCESS_SECRET")});const o=this.jwtService.decode(t);if(!(0,h.isString)(o?.sub))throw new l.HttpException("账户不存在",l.HttpStatus.OK);const s=await this.userService.reSetPassword({uid:o.sub,password:i,password_confirm:r});return await this.notificationService.addNodify({uid:o.sub,title:"密码已修改",content:"您已通过找回密码方式修改了密码",type:2}),s}};t.HelpService=w,t.HelpService=w=p([(0,l.Injectable)(),u("design:paramtypes",["function"==typeof(r=void 0!==f.PrismaService&&f.PrismaService)?r:Object,"function"==typeof(o=void 0!==v.UserService&&v.UserService)?o:Object,"function"==typeof(s=void 0!==_.NotificationService&&_.NotificationService)?s:Object,"function"==typeof(n=void 0!==y.JwtService&&y.JwtService)?n:Object,"function"==typeof(a=void 0!==m.ConfigService&&m.ConfigService)?a:Object,"function"==typeof(c=void 0!==b.SmsService&&b.SmsService)?c:Object,"function"==typeof(d=void 0!==j.RedisService&&j.RedisService)?d:Object])],w)},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FIND_PASSWORD_CONTENT=void 0,t.FIND_PASSWORD_CONTENT='\n<table bgcolor=#fff border=0 cellpadding=0 cellspacing=0  style="text-align:center;width:520px;margin:16px auto;padding:24px 24px 40px;border-radius:0 0 8px 8px;box-shadow:#c1c1c1 0 0 1px"><tr><td><div style="margin:0 auto;padding:50px 0;font-size:32px;font-weight:600;letter-spacing:0;border-bottom:4px solid #2aacff">Hapydev 找回密码</div><tr><td><div style="max-width:400px;margin:0 auto;word-break:break-all;padding-top:20px;font-size:14px;text-align:left;line-height:1.4;left:0;font-weight:400"><p>您好！<p>你的找回密码的请求已经收到，请在30分钟之内点击以下按钮验证后进行修改密码操作：<p><a href={link} style="height:32px;background-color:#2aacff;display:inline-block;color:#fff;padding:0 5px;line-height:32px;border-radius:4px;text-decoration:none">修改密码</a><p>如果按钮无法点击，请点击或复制以下链接到浏览器地址栏打开: <a href={link} target=_blank>{link}</a></div><tr><td style="font-size:13px;line-height:1.6;color:#5c5c5c;padding:25px 0"><div style=color:rgba(24,24,25,.42);font-size:14px;line-height:20px;margin-top:32px><a href=https://www.hapydev.com style=color:#2aacff;text-decoration:none rel=noopener target=_blank>Hapydev</a> - 更懂中国程序员的研发效率工具</div></table>\n'}],t={};function i(r){var o=t[r];if(void 0!==o)return o.exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,i),s.exports}var r={};(()=>{var e=r;Object.defineProperty(e,"__esModule",{value:!0});const t=i(1),o=i(2),s=i(3),n=i(126);!async function(){const e=await t.NestFactory.create(o.AppModule,{cors:{origin:"*",methods:"GET,PUT,PATCH,POST,DELETE"}});e.use(n.json({limit:"50mb"})),e.enableVersioning({type:s.VersioningType.URI}),e.setGlobalPrefix("api"),await e.listen(6002),console.log("netst Application is Start in Port 6002")}()})()})();